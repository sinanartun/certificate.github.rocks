!function(t){"use strict";var e,n,r,i,o=tinymce.util.Tools.resolve("tinymce.PluginManager"),a=function(){},u=function(t){return function(){return t}},c=function(t){return t},l=u(!1),s=u(!0),f=function(){return d},d=(e=function(t){return t.isNone()},i={fold:function(t,e){return t()},is:l,isSome:l,isNone:s,getOr:r=function(t){return t},getOrThunk:n=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:u(null),getOrUndefined:u(void 0),or:r,orThunk:n,map:f,each:a,bind:f,exists:l,forall:s,filter:f,equals:e,equals_:e,toArray:function(){return[]},toString:u("none()")},Object.freeze&&Object.freeze(i),i),m=function(t){var e=u(t),n=function(){return i},r=function(e){return e(t)},i={fold:function(e,n){return n(t)},is:function(e){return t===e},isSome:s,isNone:l,getOr:e,getOrThunk:e,getOrDie:e,getOrNull:e,getOrUndefined:e,or:n,orThunk:n,map:function(e){return m(e(t))},each:function(e){e(t)},bind:r,exists:r,forall:r,filter:function(e){return e(t)?i:d},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(e){return e.is(t)},equals_:function(e,n){return e.fold(l,function(e){return n(t,e)})}};return i},p={some:m,none:f,from:function(t){return null==t?d:m(t)}},g=function(t){return function(e){return function(t){if(null===t)return"null";var e=typeof t;return"object"===e&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"===e&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":e}(e)===t}},h=g("string"),v=g("object"),y=g("array"),b=g("boolean"),w=g("function"),T=Array.prototype.slice,_=Array.prototype.push,U=function(t){for(var e=[],n=0,r=t.length;n<r;++n){if(!y(t[n]))throw new Error("Arr.flatten item "+n+" was not an array, input: "+t);_.apply(e,t[n])}return e},x=(w(Array.from)&&Array.from,function(){return(x=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)}),A={},I={exports:A};!function(t,e,n,r){!function(r){if("object"==typeof e&&void 0!==n)n.exports=r();else if("function"==typeof t&&t.amd)t([],r);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).EphoxContactWrapper=r()}}(function(){return function(){return function t(e,n,i){function o(u,c){if(!n[u]){if(!e[u]){var l="function"==typeof r&&r;if(!c&&l)return l(u,!0);if(a)return a(u,!0);var s=new Error("Cannot find module '"+u+"'");throw s.code="MODULE_NOT_FOUND",s}var f=n[u]={exports:{}};e[u][0].call(f.exports,function(t){return o(e[u][1][t]||t)},f,f.exports,t,e,n,i)}return n[u].exports}for(var a="function"==typeof r&&r,u=0;u<i.length;u++)o(i[u]);return o}}()({1:[function(t,e,n){var r,i,o=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function u(){throw new Error("clearTimeout has not been defined")}function c(t){if(r===setTimeout)return setTimeout(t,0);if((r===a||!r)&&setTimeout)return r=setTimeout,setTimeout(t,0);try{return r(t,0)}catch(e){try{return r.call(null,t,0)}catch(e){return r.call(this,t,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:a}catch(t){r=a}try{i="function"==typeof clearTimeout?clearTimeout:u}catch(t){i=u}}();var l,s=[],f=!1,d=-1;function m(){f&&l&&(f=!1,l.length?s=l.concat(s):d=-1,s.length&&p())}function p(){if(!f){var t=c(m);f=!0;for(var e=s.length;e;){for(l=s,s=[];++d<e;)l&&l[d].run();d=-1,e=s.length}l=null,f=!1,function(t){if(i===clearTimeout)return clearTimeout(t);if((i===u||!i)&&clearTimeout)return i=clearTimeout,clearTimeout(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(t)}}function g(t,e){this.fun=t,this.array=e}function h(){}o.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new g(t,e)),1!==s.length||f||c(p)},g.prototype.run=function(){this.fun.apply(null,this.array)},o.title="browser",o.browser=!0,o.env={},o.argv=[],o.version="",o.versions={},o.on=h,o.addListener=h,o.once=h,o.off=h,o.removeListener=h,o.removeAllListeners=h,o.emit=h,o.prependListener=h,o.prependOnceListener=h,o.listeners=function(t){return[]},o.binding=function(t){throw new Error("process.binding is not supported")},o.cwd=function(){return"/"},o.chdir=function(t){throw new Error("process.chdir is not supported")},o.umask=function(){return 0}},{}],2:[function(t,e,n){(function(t){!function(n){var r=setTimeout;function i(){}function o(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof t)throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],f(t,this)}function a(t,e){for(;3===t._state;)t=t._value;0!==t._state?(t._handled=!0,o._immediateFn(function(){var n=1===t._state?e.onFulfilled:e.onRejected;if(null!==n){var r;try{r=n(t._value)}catch(t){return void c(e.promise,t)}u(e.promise,r)}else(1===t._state?u:c)(e.promise,t._value)})):t._deferreds.push(e)}function u(t,e){try{if(e===t)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var n=e.then;if(e instanceof o)return t._state=3,t._value=e,void l(t);if("function"==typeof n)return void f((r=n,i=e,function(){r.apply(i,arguments)}),t)}t._state=1,t._value=e,l(t)}catch(e){c(t,e)}var r,i}function c(t,e){t._state=2,t._value=e,l(t)}function l(t){2===t._state&&0===t._deferreds.length&&o._immediateFn(function(){t._handled||o._unhandledRejectionFn(t._value)});for(var e=0,n=t._deferreds.length;e<n;e++)a(t,t._deferreds[e]);t._deferreds=null}function s(t,e,n){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.promise=n}function f(t,e){var n=!1;try{t(function(t){n||(n=!0,u(e,t))},function(t){n||(n=!0,c(e,t))})}catch(t){if(n)return;n=!0,c(e,t)}}o.prototype.catch=function(t){return this.then(null,t)},o.prototype.then=function(t,e){var n=new this.constructor(i);return a(this,new s(t,e,n)),n},o.all=function(t){var e=Array.prototype.slice.call(t);return new o(function(t,n){if(0===e.length)return t([]);var r=e.length;function i(o,a){try{if(a&&("object"==typeof a||"function"==typeof a)){var u=a.then;if("function"==typeof u)return void u.call(a,function(t){i(o,t)},n)}e[o]=a,0==--r&&t(e)}catch(t){n(t)}}for(var o=0;o<e.length;o++)i(o,e[o])})},o.resolve=function(t){return t&&"object"==typeof t&&t.constructor===o?t:new o(function(e){e(t)})},o.reject=function(t){return new o(function(e,n){n(t)})},o.race=function(t){return new o(function(e,n){for(var r=0,i=t.length;r<i;r++)t[r].then(e,n)})},o._immediateFn="function"==typeof t?function(e){t(e)}:function(t){r(t,0)},o._unhandledRejectionFn=function(t){"undefined"!=typeof console&&console&&console.warn("Possible Unhandled Promise Rejection:",t)},o._setImmediateFn=function(t){o._immediateFn=t},o._setUnhandledRejectionFn=function(t){o._unhandledRejectionFn=t},void 0!==e&&e.exports?e.exports=o:n.Promise||(n.Promise=o)}(this)}).call(this,t("timers").setImmediate)},{timers:3}],3:[function(t,e,n){(function(e,r){var i=t("process/browser.js").nextTick,o=Function.prototype.apply,a=Array.prototype.slice,u={},c=0;function l(t,e){this._id=t,this._clearFn=e}n.setTimeout=function(){return new l(o.call(setTimeout,window,arguments),clearTimeout)},n.setInterval=function(){return new l(o.call(setInterval,window,arguments),clearInterval)},n.clearTimeout=n.clearInterval=function(t){t.close()},l.prototype.unref=l.prototype.ref=function(){},l.prototype.close=function(){this._clearFn.call(window,this._id)},n.enroll=function(t,e){clearTimeout(t._idleTimeoutId),t._idleTimeout=e},n.unenroll=function(t){clearTimeout(t._idleTimeoutId),t._idleTimeout=-1},n._unrefActive=n.active=function(t){clearTimeout(t._idleTimeoutId);var e=t._idleTimeout;e>=0&&(t._idleTimeoutId=setTimeout(function(){t._onTimeout&&t._onTimeout()},e))},n.setImmediate="function"==typeof e?e:function(t){var e=c++,r=!(arguments.length<2)&&a.call(arguments,1);return u[e]=!0,i(function(){u[e]&&(r?t.apply(null,r):t.call(null),n.clearImmediate(e))}),e},n.clearImmediate="function"==typeof r?r:function(t){delete u[t]}}).call(this,t("timers").setImmediate,t("timers").clearImmediate)},{"process/browser.js":1,timers:3}],4:[function(t,e,n){var r=t("promise-polyfill"),i="undefined"!=typeof window?window:Function("return this;")();e.exports={boltExport:i.Promise||r}},{"promise-polyfill":2}]},{},[4])(4)})}(void 0,A,I,void 0);var S=I.exports.boltExport,D=function(e){var n=p.none(),r=[],i=function(t){o()?u(t):r.push(t)},o=function(){return n.isSome()},a=function(t){!function(t,e){for(var n=0,r=t.length;n<r;n++)e(t[n],n)}(t,u)},u=function(e){n.each(function(n){t.setTimeout(function(){e(n)},0)})};return e(function(t){n=p.some(t),a(r),r=[]}),{get:i,map:function(t){return D(function(e){i(function(n){e(t(n))})})},isReady:o}},O={nu:D,pure:function(t){return D(function(e){e(t)})}},C=function(e){t.setTimeout(function(){throw e},0)},P=function(t){var e=function(e){t().then(e,C)};return{map:function(e){return P(function(){return t().then(e)})},bind:function(e){return P(function(){return t().then(function(t){return e(t).toPromise()})})},anonBind:function(e){return P(function(){return t().then(function(){return e.toPromise()})})},toLazy:function(){return O.nu(e)},toCached:function(){var e=null;return P(function(){return null===e&&(e=t()),e})},toPromise:t,get:e}},E=function(t){return P(function(){return new S(t)})},L=function(t){return P(function(){return S.resolve(t)})},N=function(t){return{is:function(e){return t===e},isValue:s,isError:l,getOr:u(t),getOrThunk:u(t),getOrDie:u(t),or:function(e){return N(t)},orThunk:function(e){return N(t)},fold:function(e,n){return n(t)},map:function(e){return N(e(t))},mapError:function(e){return N(t)},each:function(e){e(t)},bind:function(e){return e(t)},exists:function(e){return e(t)},forall:function(e){return e(t)},toOption:function(){return p.some(t)}}},j=function(t){return{is:l,isValue:l,isError:s,getOr:c,getOrThunk:function(t){return t()},getOrDie:function(){return(e=String(t),function(){throw new Error(e)})();var e},or:function(t){return t},orThunk:function(t){return t()},fold:function(e,n){return e(t)},map:function(e){return j(t)},mapError:function(e){return j(e(t))},each:a,bind:function(e){return j(t)},exists:l,forall:s,toOption:p.none}},R={value:N,error:j,fromOption:function(t,e){return t.fold(function(){return j(e)},N)}},F=function(e){return x(x({},e),{toCached:function(){return F(e.toCached())},bindFuture:function(t){return F(e.bind(function(e){return e.fold(function(t){return L(R.error(t))},function(e){return t(e)})}))},bindResult:function(t){return F(e.map(function(e){return e.bind(t)}))},mapResult:function(t){return F(e.map(function(e){return e.map(t)}))},mapError:function(t){return F(e.map(function(e){return e.mapError(t)}))},foldResult:function(t,n){return e.map(function(e){return e.fold(t,n)})},withTimeout:function(n,r){return F(E(function(i){var o=!1,a=t.setTimeout(function(){o=!0,i(R.error(r()))},n);e.get(function(e){o||(t.clearTimeout(a),i(e))})}))}})},k=function(t){return F(E(t))},z=k,M=Object.prototype.hasOwnProperty,H=function(t){return function(){for(var e=new Array(arguments.length),n=0;n<e.length;n++)e[n]=arguments[n];if(0===e.length)throw new Error("Can't merge zero objects");for(var r={},i=0;i<e.length;i++){var o=e[i];for(var a in o)M.call(o,a)&&(r[a]=t(r[a],o[a]))}return r}},B=H(function(t,e){return v(t)&&v(e)?B(t,e):e}),G=H(function(t,e){return e}),W=function(t){var e=t.imageList.map(function(t){return{name:"images",type:"selectbox",label:"Image list",items:t}}),n=t.classList.map(function(t){return{name:"classes",type:"selectbox",label:"Class",items:t}});return U([[{name:"src",type:"urlinput",filetype:"image",label:"Source"}],e.toArray(),t.hasDescription?[{name:"alt",type:"input",label:"Image description"}]:[],t.hasImageTitle?[{name:"title",type:"input",label:"Image title"}]:[],t.hasDimensions?[{name:"dimensions",type:"sizeinput"}]:[],[{type:"grid",columns:2,items:U([n.toArray(),t.hasImageCaption?[{type:"label",label:"Caption",items:[{type:"checkbox",name:"caption",label:"Show caption"}]}]:[]])}]])},q=function(t){return{title:"General",name:"general",items:W(t)}},$=W,J=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),V=tinymce.util.Tools.resolve("tinymce.util.Promise"),X=tinymce.util.Tools.resolve("tinymce.util.XHR"),Z=function(t){return t.getParam("images_upload_url","","string")},K=function(t){return t.getParam("images_upload_handler",void 0,"function")},Q={hasDimensions:function(t){return t.getParam("image_dimensions",!0,"boolean")},hasUploadTab:function(t){return t.getParam("image_uploadtab",!0,"boolean")},hasAdvTab:function(t){return t.getParam("image_advtab",!1,"boolean")},getPrependUrl:function(t){return t.getParam("image_prepend_url","","string")},getClassList:function(t){return t.getParam("image_class_list")},hasDescription:function(t){return t.getParam("image_description",!0,"boolean")},hasImageTitle:function(t){return t.getParam("image_title",!1,"boolean")},hasImageCaption:function(t){return t.getParam("image_caption",!1,"boolean")},getImageList:function(t){return t.getParam("image_list",!1)},hasUploadUrl:function(t){return!!Z(t)},hasUploadHandler:function(t){return!!K(t)},getUploadUrl:Z,getUploadHandler:K,getUploadBasePath:function(t){return t.getParam("images_upload_base_path",void 0,"string")},getUploadCredentials:function(t){return t.getParam("images_upload_credentials",!1,"boolean")}},Y=function(t,e){return Math.max(parseInt(t,10),parseInt(e,10))},tt=function(e,n){var r=t.document.createElement("img"),i=function(t){r.parentNode&&r.parentNode.removeChild(r),n(t)};r.onload=function(){var t={width:Y(r.width,r.clientWidth),height:Y(r.height,r.clientHeight)};i(R.value(t))},r.onerror=function(){i(R.error("Failed to get image dimensions for: "+e))};var o=r.style;o.visibility="hidden",o.position="fixed",o.bottom=o.left="0px",o.width=o.height="auto",t.document.body.appendChild(r),r.src=e},et=function(t){return t&&(t=t.replace(/px$/,"")),t},nt=function(t){return t.length>0&&/^[0-9]+$/.test(t)&&(t+="px"),t},rt=function(t){if(t.margin){var e=String(t.margin).split(" ");switch(e.length){case 1:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[0],t["margin-bottom"]=t["margin-bottom"]||e[0],t["margin-left"]=t["margin-left"]||e[0];break;case 2:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[1],t["margin-bottom"]=t["margin-bottom"]||e[0],t["margin-left"]=t["margin-left"]||e[1];break;case 3:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[1],t["margin-bottom"]=t["margin-bottom"]||e[2],t["margin-left"]=t["margin-left"]||e[1];break;case 4:t["margin-top"]=t["margin-top"]||e[0],t["margin-right"]=t["margin-right"]||e[1],t["margin-bottom"]=t["margin-bottom"]||e[2],t["margin-left"]=t["margin-left"]||e[3]}delete t.margin}return t},it=function(t,e){var n=Q.getImageList(t);"string"==typeof n?X.send({url:n,success:function(t){e(JSON.parse(t))}}):"function"==typeof n?n(e):e(n)},ot=function(t,e,n){var r=function(){n.onload=n.onerror=null,t.selection&&(t.selection.select(n),t.nodeChanged())};n.onload=function(){e.width||e.height||!Q.hasDimensions(t)||t.dom.setAttribs(n,{width:String(n.clientWidth),height:String(n.clientHeight)}),r()},n.onerror=r},at=function(e){return new V(function(n,r){var i=new t.FileReader;i.onload=function(){n(i.result)},i.onerror=function(){r(i.error.message)},i.readAsDataURL(e)})},ut=function(t){return"IMG"===t.nodeName&&(t.hasAttribute("data-mce-object")||t.hasAttribute("data-mce-placeholder"))},ct=J.DOM,lt=function(t){return t.style.marginLeft&&t.style.marginRight&&t.style.marginLeft===t.style.marginRight?et(t.style.marginLeft):""},st=function(t){return t.style.marginTop&&t.style.marginBottom&&t.style.marginTop===t.style.marginBottom?et(t.style.marginTop):""},ft=function(t){return t.style.borderWidth?et(t.style.borderWidth):""},dt=function(t,e){return t.hasAttribute(e)?t.getAttribute(e):""},mt=function(t,e){return t.style[e]?t.style[e]:""},pt=function(t){return null!==t.parentNode&&"FIGURE"===t.parentNode.nodeName},gt=function(t,e,n){t.setAttribute(e,n)},ht=function(t){pt(t)?function(t){var e=t.parentNode;ct.insertAfter(t,e),ct.remove(e)}(t):function(t){var e=ct.create("figure",{class:"image"});ct.insertAfter(e,t),e.appendChild(t),e.appendChild(ct.create("figcaption",{contentEditable:"true"},"Caption")),e.contentEditable="false"}(t)},vt=function(t,e){var n=t.getAttribute("style"),r=e(null!==n?n:"");r.length>0?(t.setAttribute("style",r),t.setAttribute("data-mce-style",r)):t.removeAttribute("style")},yt=function(t,e){return function(t,n,r){t.style[n]?(t.style[n]=nt(r),vt(t,e)):gt(t,n,r)}},bt=function(t,e){return t.style[e]?et(t.style[e]):dt(t,e)},wt=function(t,e){var n=nt(e);t.style.marginLeft=n,t.style.marginRight=n},Tt=function(t,e){var n=nt(e);t.style.marginTop=n,t.style.marginBottom=n},_t=function(t,e){var n=nt(e);t.style.borderWidth=n},Ut=function(t,e){t.style.borderStyle=e},xt=function(t){return"FIGURE"===t.nodeName},At=function(e,n){var r=t.document.createElement("img");return gt(r,"style",n.style),(lt(r)||""!==n.hspace)&&wt(r,n.hspace),(st(r)||""!==n.vspace)&&Tt(r,n.vspace),(ft(r)||""!==n.border)&&_t(r,n.border),(function(t){return mt(t,"borderStyle")}(r)||""!==n.borderStyle)&&Ut(r,n.borderStyle),e(r.getAttribute("style"))},It=function(t,e){return{src:dt(e,"src"),alt:dt(e,"alt"),title:dt(e,"title"),width:bt(e,"width"),height:bt(e,"height"),class:dt(e,"class"),style:t(dt(e,"style")),caption:pt(e),hspace:lt(e),vspace:st(e),border:ft(e),borderStyle:mt(e,"borderStyle")}},St=function(t,e,n,r,i){n[r]!==e[r]&&i(t,r,n[r])},Dt=function(t,e){return function(n,r,i){t(n,i),vt(n,e)}},Ot=function(t,e,n){var r=It(t,n);St(n,r,e,"caption",function(t,e,n){return ht(t)}),St(n,r,e,"src",gt),St(n,r,e,"alt",gt),St(n,r,e,"title",gt),St(n,r,e,"width",yt(0,t)),St(n,r,e,"height",yt(0,t)),St(n,r,e,"class",gt),St(n,r,e,"style",Dt(function(t,e){return gt(t,"style",e)},t)),St(n,r,e,"hspace",Dt(wt,t)),St(n,r,e,"vspace",Dt(Tt,t)),St(n,r,e,"border",Dt(_t,t)),St(n,r,e,"borderStyle",Dt(Ut,t))},Ct=function(t,e){var n=t.dom.styles.parse(e),r=rt(n),i=t.dom.styles.parse(t.dom.styles.serialize(r));return t.dom.styles.serialize(i)},Pt=function(t){var e=t.selection.getNode(),n=t.dom.getParent(e,"figure.image");return n?t.dom.select("img",n)[0]:e&&("IMG"!==e.nodeName||ut(e))?null:e},Et=function(t,e){var n=t.dom,r=n.getParent(e.parentNode,function(e){return t.schema.getTextBlockElements()[e.nodeName]},t.getBody());return r?n.split(r,e):e},Lt=function(e,n){var r=function(e,n){var r=t.document.createElement("img");if(Ot(e,G(n,{caption:!1}),r),gt(r,"alt",n.alt),n.caption){var i=ct.create("figure",{class:"image"});return i.appendChild(r),i.appendChild(ct.create("figcaption",{contentEditable:"true"},"Caption")),i.contentEditable="false",i}return r}(function(t){return Ct(e,t)},n);e.dom.setAttrib(r,"data-mce-id","__mcenew"),e.focus(),e.selection.setContent(r.outerHTML);var i=e.dom.select('*[data-mce-id="__mcenew"]')[0];if(e.dom.setAttrib(i,"data-mce-id",null),xt(i)){var o=Et(e,i);e.selection.select(o)}else e.selection.select(i)},Nt=function(t,e){var n=Pt(t);n?e.src?function(t,e){var n=Pt(t);if(Ot(function(e){return Ct(t,e)},e,n),function(t,e){t.dom.setAttrib(e,"src",e.getAttribute("src"))}(t,n),xt(n.parentNode)){var r=n.parentNode;Et(t,r),t.selection.select(n.parentNode)}else t.selection.select(n),ot(t,e,n)}(t,e):function(t,e){if(e){var n=t.dom.is(e.parentNode,"figure.image")?e.parentNode:e;t.dom.remove(n),t.focus(),t.nodeChanged(),t.dom.isEmpty(t.getBody())&&(t.setContent(""),t.selection.setCursorLocation())}}(t,n):e.src&&Lt(t,e)},jt=tinymce.util.Tools.resolve("tinymce.util.Tools"),Rt=function(t){return h(t.value)?t.value:""},Ft=function(t,e){var n=[];return jt.each(t,function(t){var r=h(t.text)?t.text:h(t.title)?t.title:"";if(void 0!==t.menu){var i=Ft(t.menu,e);n.push({text:r,items:i})}else{var o=e(t);n.push({text:r,value:o})}}),n},kt=function(t){return void 0===t&&(t=Rt),function(e){return e?p.from(e).map(function(e){return Ft(e,t)}):p.none()}},zt=function(t,e){return function(t,e){for(var n=0;n<t.length;n++){var r=e(t[n],n);if(r.isSome())return r}return p.none()}(t,function(t){return function(t){return Object.prototype.hasOwnProperty.call(t,"items")}(t)?zt(t.items,e):t.value===e?p.some(t):p.none()})},Mt=kt,Ht=function(t){return kt(Rt)(t)},Bt=function(t,e){return t.bind(function(t){return zt(t,e)})},Gt=function(t,e){return t?t.replace(/\/$/,"")+"/"+e.replace(/^\//,""):e};function Wt(e){var n=function(n,r,i,o){var a,u;(a=new t.XMLHttpRequest).open("POST",e.url),a.withCredentials=e.credentials,a.upload.onprogress=function(t){o(t.loaded/t.total*100)},a.onerror=function(){i("Image upload failed due to a XHR Transport error. Code: "+a.status)},a.onload=function(){var t;a.status<200||a.status>=300?i("HTTP Error: "+a.status):(t=JSON.parse(a.responseText))&&"string"==typeof t.location?r(Gt(e.basePath,t.location)):i("Invalid JSON: "+a.responseText)},(u=new t.FormData).append("file",n.blob(),n.filename()),a.send(u)};return e=jt.extend({credentials:!1,handler:n},e),{upload:function(t){return e.url||e.handler!==n?function(t,e){return new V(function(n,r){try{e(t,n,r,a)}catch(t){r(t.message)}})}(t,e.handler):V.reject("Upload url missing from the settings.")}}}var qt=function(t){return{title:"Advanced",name:"advanced",items:[{type:"input",label:"Style",name:"style"},{type:"grid",columns:2,items:[{type:"input",label:"Vertical space",name:"vspace",inputMode:"numeric"},{type:"input",label:"Horizontal space",name:"hspace",inputMode:"numeric"},{type:"input",label:"Border width",name:"border",inputMode:"numeric"},{type:"selectbox",name:"borderstyle",label:"Border style",items:[{text:"Select...",value:""},{text:"Solid",value:"solid"},{text:"Dotted",value:"dotted"},{text:"Dashed",value:"dashed"},{text:"Double",value:"double"},{text:"Groove",value:"groove"},{text:"Ridge",value:"ridge"},{text:"Inset",value:"inset"},{text:"Outset",value:"outset"},{text:"None",value:"none"},{text:"Hidden",value:"hidden"}]}]}]}},$t=function(t){var e=Mt(function(e){return t.convertURL(e.value||e.url,"src")}),n=E(function(n){it(t,function(t){n(e(t).map(function(t){return U([[{text:"None",value:""}],t])}))})}),r=Ht(Q.getClassList(t)),i=Q.hasAdvTab(t),o=Q.hasUploadTab(t),a=Q.hasUploadUrl(t),u=Q.hasUploadHandler(t),c=function(t){var e=Pt(t);return e?It(function(e){return Ct(t,e)},e):{src:"",alt:"",title:"",width:"",height:"",class:"",style:"",caption:!1,hspace:"",vspace:"",border:"",borderStyle:""}}(t),l=Q.hasDescription(t),s=Q.hasImageTitle(t),f=Q.hasDimensions(t),d=Q.hasImageCaption(t),m=Q.getUploadUrl(t),g=Q.getUploadBasePath(t),v=Q.getUploadCredentials(t),y=Q.getUploadHandler(t),b=p.some(Q.getPrependUrl(t)).filter(function(t){return h(t)&&t.length>0});return n.map(function(t){return{image:c,imageList:t,classList:r,hasAdvTab:i,hasUploadTab:o,hasUploadUrl:a,hasUploadHandler:u,hasDescription:l,hasImageTitle:s,hasDimensions:f,hasImageCaption:d,url:m,basePath:g,credentials:v,handler:y,prependURL:b}})},Jt=function(t){return{title:"Upload",name:"upload",items:[{type:"dropzone",name:"fileinput"}]}},Vt=function(t){return{src:{value:t.src,meta:{}},images:t.src,alt:t.alt,title:t.title,dimensions:{width:t.width,height:t.height},classes:t.class,caption:t.caption,style:t.style,vspace:t.vspace,border:t.border,hspace:t.hspace,borderstyle:t.borderStyle,fileinput:[]}},Xt=function(t){return{src:t.src.value,alt:t.alt,title:t.title,width:t.dimensions.width,height:t.dimensions.height,class:t.classes,style:t.style,caption:t.caption,hspace:t.hspace,vspace:t.vspace,border:t.border,borderStyle:t.borderstyle}},Zt=function(t,e){var n=e.getData();(function(t,e){return/^(?:[a-zA-Z]+:)?\/\//.test(e)?p.none():t.prependURL.bind(function(t){return e.substring(0,t.length)!==t?p.some(t+e):p.none()})})(t,n.src.value).each(function(t){e.setData({src:{value:t,meta:n.src.meta}})})},Kt=function(t,e){var n=e.getData(),r=n.src.meta;if(void 0!==r){var i=B({},n);!function(t,e,n){t.hasDescription&&h(n.alt)&&(e.alt=n.alt),t.hasImageTitle&&h(n.title)&&(e.title=n.title),t.hasDimensions&&(h(n.width)&&(e.dimensions.width=n.width),h(n.height)&&(e.dimensions.height=n.height)),h(n.class)&&Bt(t.classList,n.class).each(function(t){e.classes=t.value}),t.hasImageCaption&&b(n.caption)&&(e.caption=n.caption),t.hasAdvTab&&(h(n.vspace)&&(e.vspace=n.vspace),h(n.border)&&(e.border=n.border),h(n.hspace)&&(e.hspace=n.hspace),h(n.borderstyle)&&(e.borderstyle=n.borderstyle))}(t,i,r),e.setData(i)}},Qt=function(t,e,n,r){Zt(e,r),Kt(e,r),function(t,e,n,r){var i=r.getData(),o=i.src.value,a=i.src.meta||{};a.width||a.height||!e.hasDimensions||t.imageSize(o).get(function(t){t.each(function(t){n.open&&r.setData({dimensions:t})})})}(t,e,n,r),function(t,e,n){var r=n.getData(),i=Bt(t.imageList,r.src.value);e.prevImage=i,n.setData({images:i.map(function(t){return t.value}).getOr("")})}(e,n,r)},Yt=function(t,e,n){var r=rt(t(n.style)),i=B({},n);return i.vspace=function(t){return t["margin-top"]&&t["margin-bottom"]&&t["margin-top"]===t["margin-bottom"]?et(String(t["margin-top"])):""}(r),i.hspace=function(t){return t["margin-right"]&&t["margin-left"]&&t["margin-right"]===t["margin-left"]?et(String(t["margin-right"])):""}(r),i.border=function(t){return t["border-width"]?et(String(t["border-width"])):""}(r),i.borderstyle=function(t){return t["border-style"]?String(t["border-style"]):""}(r),i.style=function(t,e,n){return e(t(e(n)))}(t,e,r),i},te=function(e,n,r,i){var o,a=i.getData();i.block("Uploading image"),(o=a.fileinput,0===o.length?p.none():p.some(o[0])).fold(function(){i.unblock()},function(o){var a=t.URL.createObjectURL(o),u=Wt({url:n.url,basePath:n.basePath,credentials:n.credentials,handler:n.handler}),c=function(){i.unblock(),t.URL.revokeObjectURL(a)};at(o).then(function(t){var l=e.createBlobCache(o,a,t);u.upload(l).then(function(t){i.setData({src:{value:t,meta:{}}}),i.showTab("general"),Qt(e,n,r,i),c()}).catch(function(t){c(),e.alertErr(i,t)})})})},ee=function(t,e,n){return function(r,i){"src"===i.name?Qt(t,e,n,r):"images"===i.name?function(t,e,n,r){var i=r.getData(),o=Bt(e.imageList,i.images);o.each(function(t){""===i.alt||n.prevImage.map(function(t){return t.text===i.alt}).getOr(!1)?""===t.value?r.setData({src:t,alt:n.prevAlt}):r.setData({src:t,alt:t.text}):r.setData({src:t})}),n.prevImage=o,Qt(t,e,n,r)}(t,e,n,r):"alt"===i.name?n.prevAlt=r.getData().alt:"style"===i.name?function(t,e){var n=e.getData(),r=Yt(t.parseStyle,t.serializeStyle,n);e.setData(r)}(t,r):"vspace"===i.name||"hspace"===i.name||"border"===i.name||"borderstyle"===i.name?function(t,e,n){var r=B(Vt(e.image),n.getData()),i=At(t.normalizeCss,Xt(r));n.setData({style:i})}(t,e,r):"fileinput"===i.name&&te(t,e,n,r)}},ne=function(t){return function(){t.open=!1}},re=function(t){return t.hasAdvTab||t.hasUploadUrl||t.hasUploadHandler?{type:"tabpanel",tabs:U([[q(t)],t.hasAdvTab?[qt(t)]:[],t.hasUploadTab&&(t.hasUploadUrl||t.hasUploadHandler)?[Jt(t)]:[]])}:{type:"panel",items:$(t)}},ie=function(t){return function(e){var n=function(t){return{prevImage:Bt(t.imageList,t.image.src),prevAlt:t.image.alt,open:!0}}(e);return{title:"Insert/Edit Image",size:"normal",body:re(e),buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:Vt(e.image),onSubmit:t.onSubmit(e),onChange:ee(t,e,n),onClose:ne(n)}}},oe=function(t){return function(e){return function(n){var r=B(Vt(e.image),n.getData());t.undoManager.transact(function(){Nt(t,Xt(r))}),t.editorUpload.uploadImagesAuto(),n.close()}}},ae=function(t){return function(e){return z(function(n){tt(t.documentBaseURI.toAbsolute(e),function(t){var e=t.map(function(t){return{width:String(t.width),height:String(t.height)}});n(e)})})}},ue=function(t){return function(e,n,r){return t.editorUpload.blobCache.create({blob:e,blobUri:n,name:e.name?e.name.replace(/\.[^\.]+$/,""):null,base64:r.split(",")[1]})}},ce=function(t){return function(e,n){t.windowManager.alert(n,e.close)}},le=function(t){return function(e){return Ct(t,e)}},se=function(t){return function(e){return t.dom.parseStyle(e)}},fe=function(t){return function(e,n){return t.dom.serializeStyle(e,n)}},de=function(t){var e={onSubmit:oe(t),imageSize:ae(t),createBlobCache:ue(t),alertErr:ce(t),normalizeCss:le(t),parseStyle:se(t),serializeStyle:fe(t)};return{open:function(){return $t(t).map(ie(e)).get(function(e){t.windowManager.open(e)})}}},me={register:function(t){t.addCommand("mceImage",de(t).open)}},pe=function(t){var e=t.attr("class");return e&&/\bimage\b/.test(e)},ge=function(t){return function(e){for(var n=e.length,r=function(e){e.attr("contenteditable",t?"true":null)};n--;){var i=e[n];pe(i)&&(i.attr("contenteditable",t?"false":null),jt.each(i.getAll("figcaption"),r))}}},he={setup:function(t){t.on("PreInit",function(){t.parser.addNodeFilter("figure",ge(!0)),t.serializer.addNodeFilter("figure",ge(!1))})}},ve={register:function(t){t.ui.registry.addToggleButton("image",{icon:"image",tooltip:"Insert/edit image",onAction:de(t).open,onSetup:function(e){return t.selection.selectorChangedWithUnbind("img:not([data-mce-object],[data-mce-placeholder]),figure.image",e.setActive).unbind}}),t.ui.registry.addMenuItem("image",{icon:"image",text:"Image...",onAction:de(t).open}),t.ui.registry.addContextMenu("image",{update:function(t){return xt(t)||"IMG"===t.nodeName&&!ut(t)?["image"]:[]}})}};o.add("image",function(t){he.setup(t),ve.register(t),me.register(t)})}(window);
//# sourceMappingURL=plugin.js.map
