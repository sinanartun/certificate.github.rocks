{"version":3,"sources":["autosave/plugin.min.js"],"names":["n","r","t","e","exec","s","m","parseInt","o","getParam","replace","document","location","pathname","search","hash","id","a","settings","forced_root_block","d","trim","getBody","innerHTML","RegExp","test","i","v","getItem","Date","getTime","autosave_retention","g","u","isDirty","setItem","getContent","format","no_events","toString","fire","setContent","f","undoManager","transact","focus","l","get","set","clone","tinymce","util","Tools","resolve","removeItem","y","arguments","length","concat","apply","p","setDisabled","on","off","D","add","editorManager","each","plugins","autosave","storeDraft","translate","preventDefault","returnValue","autosave_interval","setInterval","removed","c","ui","registry","addButton","tooltip","icon","onAction","onSetup","addMenuItem","text","dom","isEmpty","hasDraft","restoreDraft","removeDraft","window"],"mappings":"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","file":"plugin.min.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.1.0 (2019-10-17)\n */\n!function(n){\"use strict\";function r(t,e){var n=t||e,r=/^(\\d+)([ms]?)$/.exec(\"\"+n);return(r[2]?{s:1e3,m:6e4}[r[2]]:1)*parseInt(n,10)}function o(t){var e=t.getParam(\"autosave_prefix\",\"tinymce-autosave-{path}{query}{hash}-{id}-\");return e=(e=(e=(e=e.replace(/\\{path\\}/g,n.document.location.pathname)).replace(/\\{query\\}/g,n.document.location.search)).replace(/\\{hash\\}/g,n.document.location.hash)).replace(/\\{id\\}/g,t.id)}function a(t,e){var n=t.settings.forced_root_block;return\"\"===(e=d.trim(void 0===e?t.getBody().innerHTML:e))||new RegExp(\"^<\"+n+\"[^>]*>((\\xa0|&nbsp;|[ \\t]|<br[^>]*>)+?|)</\"+n+\">|<br>$\",\"i\").test(e)}function i(t){var e=parseInt(v.getItem(o(t)+\"time\"),10)||0;return!((new Date).getTime()-e>function(t){return r(t.settings.autosave_retention,\"20m\")}(t))||(g(t,!1),!1)}function u(t){var e=o(t);!a(t)&&t.isDirty()&&(v.setItem(e+\"draft\",t.getContent({format:\"raw\",no_events:!0})),v.setItem(e+\"time\",(new Date).getTime().toString()),function(t){t.fire(\"StoreDraft\")}(t))}function s(t){var e=o(t);i(t)&&(t.setContent(v.getItem(e+\"draft\"),{format:\"raw\"}),function(t){t.fire(\"RestoreDraft\")}(t))}function c(t,e){var n=function(t){return r(t.settings.autosave_interval,\"30s\")}(t);e.get()||(m.setInterval(function(){t.removed||u(t)},n),e.set(!0))}function f(t){t.undoManager.transact(function(){s(t),g(t)}),t.focus()}var l=function(t){function e(){return n}var n=t;return{get:e,set:function(t){n=t},clone:function(){return l(e())}}},t=tinymce.util.Tools.resolve(\"tinymce.PluginManager\"),m=tinymce.util.Tools.resolve(\"tinymce.util.Delay\"),v=tinymce.util.Tools.resolve(\"tinymce.util.LocalStorage\"),d=tinymce.util.Tools.resolve(\"tinymce.util.Tools\"),g=function(t,e){var n=o(t);v.removeItem(n+\"draft\"),v.removeItem(n+\"time\"),!1!==e&&function(t){t.fire(\"RemoveDraft\")}(t)};function y(r){for(var o=[],t=1;t<arguments.length;t++)o[t-1]=arguments[t];return function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=o.concat(t);return r.apply(null,n)}}function p(n,t){return function(t){t.setDisabled(!i(n));function e(){return t.setDisabled(!i(n))}return n.on(\"StoreDraft RestoreDraft RemoveDraft\",e),function(){return n.off(\"StoreDraft RestoreDraft RemoveDraft\",e)}}}var D=tinymce.util.Tools.resolve(\"tinymce.EditorManager\");!function e(){t.add(\"autosave\",function(t){var e=l(!1);return function(t){t.editorManager.on(\"BeforeUnload\",function(t){var e;d.each(D.get(),function(t){t.plugins.autosave&&t.plugins.autosave.storeDraft(),!e&&t.isDirty()&&function(t){return t.getParam(\"autosave_ask_before_unload\",!0)}(t)&&(e=t.translate(\"You have unsaved changes are you sure you want to navigate away?\"))}),e&&(t.preventDefault(),t.returnValue=e)})}(t),function(t,e){c(t,e),t.ui.registry.addButton(\"restoredraft\",{tooltip:\"Restore last draft\",icon:\"restore-draft\",onAction:function(){f(t)},onSetup:p(t)}),t.ui.registry.addMenuItem(\"restoredraft\",{text:\"Restore last draft\",icon:\"restore-draft\",onAction:function(){f(t)},onSetup:p(t)})}(t,e),t.on(\"init\",function(){(function(t){return t.getParam(\"autosave_restore_when_empty\",!1)})(t)&&t.dom.isEmpty(t.getBody())&&s(t)}),function(t){return{hasDraft:y(i,t),storeDraft:y(u,t),restoreDraft:y(s,t),removeDraft:y(g,t),isEmpty:y(a,t)}}(t)})}()}(window);"]}