{"version":3,"sources":["visualchars/plugin.js"],"names":["domGlobals","eq","call","id","me","t","Cell","initial","value","get","set","v","clone","global","tinymce","util","Tools","resolve","Api","toggleState","isEnabled","Events","editor","state","fire","noop","constant","never","always","none","NONE","o","isNone","fold","n","s","is","isSome","getOr","getOrThunk","thunk","getOrDie","msg","Error","getOrNull","getOrUndefined","undefined","or","orThunk","map","each","bind","exists","forall","filter","equals","equals_","toArray","toString","Object","freeze","some","a","constant_a","self","f","elementEq","b","Option","isType","type","x","Array","prototype","isPrototypeOf","constructor","name","String","typeOf","isString","isBoolean","isFunction","isNumber","nativeSlice","slice","xs","i","len","length","TEXT","from","Node","ATTRIBUTE_NODE","CDATA_SECTION_NODE","COMMENT_NODE","DOCUMENT_NODE","DOCUMENT_TYPE_NODE","DOCUMENT_FRAGMENT_NODE","ELEMENT_NODE","TEXT_NODE","PROCESSING_INSTRUCTION_NODE","ENTITY_REFERENCE_NODE","ENTITY_NODE","NOTATION_NODE","window","Function","element","dom","nodeValue","isText","nodeType","key","console","error","setAttribute","rawSet","remove","removeAttribute","read","attr","getAttribute","get$1","split","supports","classList","add$1","clazz","nu","concat","join","add","remove$2","pred","r","push","remove$1","cleanClass","get$2","fromDom","node","Element","fromHtml","html","scope","div","document","createElement","innerHTML","hasChildNodes","childNodes","fromTag","tag","fromText","text","createTextNode","fromPoint","docElm","y","doc","elementFromPoint","charMap"," ","­","charMapToRegExp","regExp","RegExp","charMapToSelector","selector","Data","regExpGlobal","nbspClass","Html","filterDescendants","predicate","result","children","Nodes","isMatch","test","findParentElm","elm","rootElm","parentNode","replaceWithSpans","replace","isWrappedNbsp","nodeName","toLowerCase","contains","show","nodeList","parent","withSpans","create","lastChild","insertAfter","hide","select","remove$3","VisualChars","body","getBody","bookmark","selection","getBookmark","getNode","moveToBookmark","Actions","Commands","register","addCommand","global$1","Keyboard","setup","debouncedToggle","debounce","settings","forced_root_block","on","e","keyCode","Settings","getParam","Bindings","valueForToggling","toggleActiveState","enabledStated","api","setActive","editorEventCallback","off","register$1","ui","registry","addToggleButton","tooltip","icon","onAction","execCommand","onSetup","addToggleMenuItem"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.1.0 (2019-10-17)\n */\n(function (domGlobals) {\n    'use strict';\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      var clone = function () {\n        return Cell(get());\n      };\n      return {\n        get: get,\n        set: set,\n        clone: clone\n      };\n    };\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var get = function (toggleState) {\n      var isEnabled = function () {\n        return toggleState.get();\n      };\n      return { isEnabled: isEnabled };\n    };\n    var Api = { get: get };\n\n    var fireVisualChars = function (editor, state) {\n      return editor.fire('VisualChars', { state: state });\n    };\n    var Events = { fireVisualChars: fireVisualChars };\n\n    var noop = function () {\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      if (Object.freeze) {\n        Object.freeze(me);\n      }\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Option = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var typeOf = function (x) {\n      if (x === null) {\n        return 'null';\n      }\n      var t = typeof x;\n      if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      }\n      if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      }\n      return t;\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isString = isType('string');\n    var isBoolean = isType('boolean');\n    var isFunction = isType('function');\n    var isNumber = isType('number');\n\n    var nativeSlice = Array.prototype.slice;\n    var map = function (xs, f) {\n      var len = xs.length;\n      var r = new Array(len);\n      for (var i = 0; i < len; i++) {\n        var x = xs[i];\n        r[i] = f(x, i);\n      }\n      return r;\n    };\n    var each = function (xs, f) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var filter = function (xs, pred) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        if (pred(x, i)) {\n          r.push(x);\n        }\n      }\n      return r;\n    };\n    var from$1 = isFunction(Array.from) ? Array.from : function (x) {\n      return nativeSlice.call(x);\n    };\n\n    var ATTRIBUTE = domGlobals.Node.ATTRIBUTE_NODE;\n    var CDATA_SECTION = domGlobals.Node.CDATA_SECTION_NODE;\n    var COMMENT = domGlobals.Node.COMMENT_NODE;\n    var DOCUMENT = domGlobals.Node.DOCUMENT_NODE;\n    var DOCUMENT_TYPE = domGlobals.Node.DOCUMENT_TYPE_NODE;\n    var DOCUMENT_FRAGMENT = domGlobals.Node.DOCUMENT_FRAGMENT_NODE;\n    var ELEMENT = domGlobals.Node.ELEMENT_NODE;\n    var TEXT = domGlobals.Node.TEXT_NODE;\n    var PROCESSING_INSTRUCTION = domGlobals.Node.PROCESSING_INSTRUCTION_NODE;\n    var ENTITY_REFERENCE = domGlobals.Node.ENTITY_REFERENCE_NODE;\n    var ENTITY = domGlobals.Node.ENTITY_NODE;\n    var NOTATION = domGlobals.Node.NOTATION_NODE;\n\n    var Global = typeof domGlobals.window !== 'undefined' ? domGlobals.window : Function('return this;')();\n\n    var type = function (element) {\n      return element.dom().nodeType;\n    };\n    var value = function (element) {\n      return element.dom().nodeValue;\n    };\n    var isType$1 = function (t) {\n      return function (element) {\n        return type(element) === t;\n      };\n    };\n    var isText = isType$1(TEXT);\n\n    var rawSet = function (dom, key, value) {\n      if (isString(value) || isBoolean(value) || isNumber(value)) {\n        dom.setAttribute(key, value + '');\n      } else {\n        domGlobals.console.error('Invalid call to Attr.set. Key ', key, ':: Value ', value, ':: Element ', dom);\n        throw new Error('Attribute value was not simple');\n      }\n    };\n    var set = function (element, key, value) {\n      rawSet(element.dom(), key, value);\n    };\n    var get$1 = function (element, key) {\n      var v = element.dom().getAttribute(key);\n      return v === null ? undefined : v;\n    };\n    var remove = function (element, key) {\n      element.dom().removeAttribute(key);\n    };\n\n    var read = function (element, attr) {\n      var value = get$1(element, attr);\n      return value === undefined || value === '' ? [] : value.split(' ');\n    };\n    var add = function (element, attr, id) {\n      var old = read(element, attr);\n      var nu = old.concat([id]);\n      set(element, attr, nu.join(' '));\n      return true;\n    };\n    var remove$1 = function (element, attr, id) {\n      var nu = filter(read(element, attr), function (v) {\n        return v !== id;\n      });\n      if (nu.length > 0) {\n        set(element, attr, nu.join(' '));\n      } else {\n        remove(element, attr);\n      }\n      return false;\n    };\n\n    var supports = function (element) {\n      return element.dom().classList !== undefined;\n    };\n    var get$2 = function (element) {\n      return read(element, 'class');\n    };\n    var add$1 = function (element, clazz) {\n      return add(element, 'class', clazz);\n    };\n    var remove$2 = function (element, clazz) {\n      return remove$1(element, 'class', clazz);\n    };\n\n    var add$2 = function (element, clazz) {\n      if (supports(element)) {\n        element.dom().classList.add(clazz);\n      } else {\n        add$1(element, clazz);\n      }\n    };\n    var cleanClass = function (element) {\n      var classList = supports(element) ? element.dom().classList : get$2(element);\n      if (classList.length === 0) {\n        remove(element, 'class');\n      }\n    };\n    var remove$3 = function (element, clazz) {\n      if (supports(element)) {\n        var classList = element.dom().classList;\n        classList.remove(clazz);\n      } else {\n        remove$2(element, clazz);\n      }\n      cleanClass(element);\n    };\n\n    var fromHtml = function (html, scope) {\n      var doc = scope || domGlobals.document;\n      var div = doc.createElement('div');\n      div.innerHTML = html;\n      if (!div.hasChildNodes() || div.childNodes.length > 1) {\n        domGlobals.console.error('HTML does not have a single root node', html);\n        throw new Error('HTML must have a single root node');\n      }\n      return fromDom(div.childNodes[0]);\n    };\n    var fromTag = function (tag, scope) {\n      var doc = scope || domGlobals.document;\n      var node = doc.createElement(tag);\n      return fromDom(node);\n    };\n    var fromText = function (text, scope) {\n      var doc = scope || domGlobals.document;\n      var node = doc.createTextNode(text);\n      return fromDom(node);\n    };\n    var fromDom = function (node) {\n      if (node === null || node === undefined) {\n        throw new Error('Node cannot be null or undefined');\n      }\n      return { dom: constant(node) };\n    };\n    var fromPoint = function (docElm, x, y) {\n      var doc = docElm.dom();\n      return Option.from(doc.elementFromPoint(x, y)).map(fromDom);\n    };\n    var Element = {\n      fromHtml: fromHtml,\n      fromTag: fromTag,\n      fromText: fromText,\n      fromDom: fromDom,\n      fromPoint: fromPoint\n    };\n\n    var charMap = {\n      '\\xA0': 'nbsp',\n      '\\xAD': 'shy'\n    };\n    var charMapToRegExp = function (charMap, global) {\n      var key, regExp = '';\n      for (key in charMap) {\n        regExp += key;\n      }\n      return new RegExp('[' + regExp + ']', global ? 'g' : '');\n    };\n    var charMapToSelector = function (charMap) {\n      var key, selector = '';\n      for (key in charMap) {\n        if (selector) {\n          selector += ',';\n        }\n        selector += 'span.mce-' + charMap[key];\n      }\n      return selector;\n    };\n    var Data = {\n      charMap: charMap,\n      regExp: charMapToRegExp(charMap),\n      regExpGlobal: charMapToRegExp(charMap, true),\n      selector: charMapToSelector(charMap),\n      nbspClass: 'mce-nbsp',\n      charMapToRegExp: charMapToRegExp,\n      charMapToSelector: charMapToSelector\n    };\n\n    var wrapCharWithSpan = function (value) {\n      return '<span data-mce-bogus=\"1\" class=\"mce-' + Data.charMap[value] + '\">' + value + '</span>';\n    };\n    var Html = { wrapCharWithSpan: wrapCharWithSpan };\n\n    var isMatch = function (n) {\n      return isText(n) && value(n) !== undefined && Data.regExp.test(value(n));\n    };\n    var filterDescendants = function (scope, predicate) {\n      var result = [];\n      var dom = scope.dom();\n      var children = map(dom.childNodes, Element.fromDom);\n      each(children, function (x) {\n        if (predicate(x)) {\n          result = result.concat([x]);\n        }\n        result = result.concat(filterDescendants(x, predicate));\n      });\n      return result;\n    };\n    var findParentElm = function (elm, rootElm) {\n      while (elm.parentNode) {\n        if (elm.parentNode === rootElm) {\n          return elm;\n        }\n        elm = elm.parentNode;\n      }\n    };\n    var replaceWithSpans = function (html) {\n      return html.replace(Data.regExpGlobal, Html.wrapCharWithSpan);\n    };\n    var Nodes = {\n      isMatch: isMatch,\n      filterDescendants: filterDescendants,\n      findParentElm: findParentElm,\n      replaceWithSpans: replaceWithSpans\n    };\n\n    var isWrappedNbsp = function (node) {\n      return node.nodeName.toLowerCase() === 'span' && node.classList.contains('mce-nbsp-wrap');\n    };\n    var show = function (editor, rootElm) {\n      var nodeList = Nodes.filterDescendants(Element.fromDom(rootElm), Nodes.isMatch);\n      each(nodeList, function (n) {\n        var parent = n.dom().parentNode;\n        if (isWrappedNbsp(parent)) {\n          add$2(Element.fromDom(parent), Data.nbspClass);\n        } else {\n          var withSpans = Nodes.replaceWithSpans(value(n));\n          var div = editor.dom.create('div', null, withSpans);\n          var node = void 0;\n          while (node = div.lastChild) {\n            editor.dom.insertAfter(node, n.dom());\n          }\n          editor.dom.remove(n.dom());\n        }\n      });\n    };\n    var hide = function (editor, rootElm) {\n      var nodeList = editor.dom.select(Data.selector, rootElm);\n      each(nodeList, function (node) {\n        if (isWrappedNbsp(node)) {\n          remove$3(Element.fromDom(node), Data.nbspClass);\n        } else {\n          editor.dom.remove(node, true);\n        }\n      });\n    };\n    var toggle = function (editor) {\n      var body = editor.getBody();\n      var bookmark = editor.selection.getBookmark();\n      var parentNode = Nodes.findParentElm(editor.selection.getNode(), body);\n      parentNode = parentNode !== undefined ? parentNode : body;\n      hide(editor, parentNode);\n      show(editor, parentNode);\n      editor.selection.moveToBookmark(bookmark);\n    };\n    var VisualChars = {\n      show: show,\n      hide: hide,\n      toggle: toggle\n    };\n\n    var toggleVisualChars = function (editor, toggleState) {\n      var body = editor.getBody();\n      var selection = editor.selection;\n      var bookmark;\n      toggleState.set(!toggleState.get());\n      Events.fireVisualChars(editor, toggleState.get());\n      bookmark = selection.getBookmark();\n      if (toggleState.get() === true) {\n        VisualChars.show(editor, body);\n      } else {\n        VisualChars.hide(editor, body);\n      }\n      selection.moveToBookmark(bookmark);\n    };\n    var Actions = { toggleVisualChars: toggleVisualChars };\n\n    var register = function (editor, toggleState) {\n      editor.addCommand('mceVisualChars', function () {\n        Actions.toggleVisualChars(editor, toggleState);\n      });\n    };\n    var Commands = { register: register };\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Delay');\n\n    var setup = function (editor, toggleState) {\n      var debouncedToggle = global$1.debounce(function () {\n        VisualChars.toggle(editor);\n      }, 300);\n      if (editor.settings.forced_root_block !== false) {\n        editor.on('keydown', function (e) {\n          if (toggleState.get() === true) {\n            e.keyCode === 13 ? VisualChars.toggle(editor) : debouncedToggle();\n          }\n        });\n      }\n    };\n    var Keyboard = { setup: setup };\n\n    var isEnabledByDefault = function (editor) {\n      return editor.getParam('visualchars_default_state', false);\n    };\n    var Settings = { isEnabledByDefault: isEnabledByDefault };\n\n    var setup$1 = function (editor, toggleState) {\n      editor.on('init', function () {\n        var valueForToggling = !Settings.isEnabledByDefault(editor);\n        toggleState.set(valueForToggling);\n        Actions.toggleVisualChars(editor, toggleState);\n      });\n    };\n    var Bindings = { setup: setup$1 };\n\n    var toggleActiveState = function (editor, enabledStated) {\n      return function (api) {\n        api.setActive(enabledStated.get());\n        var editorEventCallback = function (e) {\n          return api.setActive(e.state);\n        };\n        editor.on('VisualChars', editorEventCallback);\n        return function () {\n          return editor.off('VisualChars', editorEventCallback);\n        };\n      };\n    };\n    var register$1 = function (editor, toggleState) {\n      editor.ui.registry.addToggleButton('visualchars', {\n        tooltip: 'Show invisible characters',\n        icon: 'visualchars',\n        onAction: function () {\n          return editor.execCommand('mceVisualChars');\n        },\n        onSetup: toggleActiveState(editor, toggleState)\n      });\n      editor.ui.registry.addToggleMenuItem('visualchars', {\n        text: 'Show invisible characters',\n        onAction: function () {\n          return editor.execCommand('mceVisualChars');\n        },\n        onSetup: toggleActiveState(editor, toggleState)\n      });\n    };\n\n    function Plugin () {\n      global.add('visualchars', function (editor) {\n        var toggleState = Cell(false);\n        Commands.register(editor, toggleState);\n        register$1(editor, toggleState);\n        Keyboard.setup(editor, toggleState);\n        Bindings.setup(editor, toggleState);\n        return Api.get(toggleState);\n      });\n    }\n\n    Plugin();\n\n}(window));\n"]}