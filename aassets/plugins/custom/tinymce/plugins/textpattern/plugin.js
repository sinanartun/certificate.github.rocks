!function(t){"use strict";var n=function(t){var e=t,r=function(){return e};return{get:r,set:function(t){e=t},clone:function(){return n(r())}}},e=tinymce.util.Tools.resolve("tinymce.PluginManager"),r=function(){return(r=Object.assign||function(t){for(var n,e=1,r=arguments.length;e<r;e++)for(var o in n=arguments[e])Object.prototype.hasOwnProperty.call(n,o)&&(t[o]=n[o]);return t}).apply(this,arguments)};var o,a,i,u,f=function(){},c=function(t){return function(){return t}},s=function(t){return t},l=c(!1),d=c(!0),m=function(){return g},g=(o=function(t){return t.isNone()},u={fold:function(t,n){return t()},is:l,isSome:l,isNone:d,getOr:i=function(t){return t},getOrThunk:a=function(t){return t()},getOrDie:function(t){throw new Error(t||"error: getOrDie called on none.")},getOrNull:c(null),getOrUndefined:c(void 0),or:i,orThunk:a,map:m,each:f,bind:m,exists:l,forall:d,filter:m,equals:o,equals_:o,toArray:function(){return[]},toString:c("none()")},Object.freeze&&Object.freeze(u),u),p=function(t){var n=c(t),e=function(){return o},r=function(n){return n(t)},o={fold:function(n,e){return e(t)},is:function(n){return t===n},isSome:d,isNone:l,getOr:n,getOrThunk:n,getOrDie:n,getOrNull:n,getOrUndefined:n,or:e,orThunk:e,map:function(n){return p(n(t))},each:function(n){n(t)},bind:r,exists:r,forall:r,filter:function(n){return n(t)?o:g},toArray:function(){return[t]},toString:function(){return"some("+t+")"},equals:function(n){return n.is(t)},equals_:function(n,e){return n.fold(l,function(n){return e(t,n)})}};return o},h={some:p,none:m,from:function(t){return null==t?g:p(t)}},v=function(t){return function(n){return function(t){if(null===t)return"null";var n=typeof t;return"object"===n&&(Array.prototype.isPrototypeOf(t)||t.constructor&&"Array"===t.constructor.name)?"array":"object"===n&&(String.prototype.isPrototypeOf(t)||t.constructor&&"String"===t.constructor.name)?"string":n}(n)===t}},y=v("string"),b=v("object"),k=v("array"),O=v("function"),w=Array.prototype.slice,x=Array.prototype.indexOf,C=function(t,n){return e=t,r=n,x.call(e,r)>-1;var e,r},E=function(t,n){for(var e=t.length,r=new Array(e),o=0;o<e;o++){var a=t[o];r[o]=n(a,o)}return r},T=function(t,n){for(var e=0,r=t.length;e<r;e++){n(t[e],e)}},R=function(t,n){for(var e=[],r=0,o=t.length;r<o;r++){var a=t[r];n(a,r)&&e.push(a)}return e},N=function(t,n,e){return function(t,n){for(var e=t.length-1;e>=0;e--)n(t[e],e)}(t,function(t){e=n(e,t)}),e},P=function(t,n){for(var e=0,r=t.length;e<r;++e){if(!0!==n(t[e],e))return!1}return!0},S=(O(Array.from)&&Array.from,Object.keys),M=Object.hasOwnProperty,A=function(t,n){return M.call(t,n)},I=function(n){if(!k(n))throw new Error("cases must be an array");if(0===n.length)throw new Error("there must be at least one case");var e=[],r={};return T(n,function(o,a){var i=S(o);if(1!==i.length)throw new Error("one and only one name per case");var u=i[0],f=o[u];if(void 0!==r[u])throw new Error("duplicate key detected:"+u);if("cata"===u)throw new Error("cannot have a case named cata (sorry)");if(!k(f))throw new Error("case arguments must be an array");e.push(u),r[u]=function(){var r=arguments.length;if(r!==f.length)throw new Error("Wrong number of arguments to case "+u+". Expected "+f.length+" ("+f+"), got "+r);for(var o=new Array(r),i=0;i<o.length;i++)o[i]=arguments[i];return{fold:function(){if(arguments.length!==n.length)throw new Error("Wrong number of arguments to fold. Expected "+n.length+", got "+arguments.length);return arguments[a].apply(null,o)},match:function(t){var n=S(t);if(e.length!==n.length)throw new Error("Wrong number of arguments to match. Expected: "+e.join(",")+"\nActual: "+n.join(","));if(!P(e,function(t){return C(n,t)}))throw new Error("Not all branches were specified when using match. Specified: "+n.join(", ")+"\nRequired: "+e.join(", "));return t[u].apply(null,o)},log:function(n){t.console.log(n,{constructors:e,constructor:u,params:o})}}}}),r},j=(I([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(t){var n=[],e=[];return T(t,function(t){t.fold(function(t){n.push(t)},function(t){e.push(t)})}),{errors:n,values:e}}),B=function(t){return{is:function(n){return t===n},isValue:d,isError:l,getOr:c(t),getOrThunk:c(t),getOrDie:c(t),or:function(n){return B(t)},orThunk:function(n){return B(t)},fold:function(n,e){return e(t)},map:function(n){return B(n(t))},mapError:function(n){return B(t)},each:function(n){n(t)},bind:function(n){return n(t)},exists:function(n){return n(t)},forall:function(n){return n(t)},toOption:function(){return h.some(t)}}},D=function(t){return{is:l,isValue:l,isError:d,getOr:s,getOrThunk:function(t){return t()},getOrDie:function(){return(n=String(t),function(){throw new Error(n)})();var n},or:function(t){return t},orThunk:function(t){return t()},fold:function(n,e){return n(t)},map:function(n){return D(t)},mapError:function(n){return D(n(t))},each:f,bind:function(n){return D(t)},exists:l,forall:d,toOption:h.none}},_={value:B,error:D,fromOption:function(t,n){return t.fold(function(){return D(n)},B)}},U=function(t){return"inline-command"===t.type||"inline-format"===t.type},q=function(t){return"block-command"===t.type||"block-format"===t.type},L=function(t){return n=t,e=function(t,n){return t.start.length===n.start.length?0:t.start.length>n.start.length?-1:1},(r=w.call(n,0)).sort(e),r;var n,e,r},V=function(t){var n=function(n){return _.error({message:n,pattern:t})},e=function(e,r,o){if(void 0!==t.format){var a=void 0;if(k(t.format)){if(!P(t.format,y))return n(e+" pattern has non-string items in the `format` array");a=t.format}else{if(!y(t.format))return n(e+" pattern has non-string `format` parameter");a=[t.format]}return _.value(r(a))}return void 0!==t.cmd?y(t.cmd)?_.value(o(t.cmd,t.value)):n(e+" pattern has non-string `cmd` parameter"):n(e+" pattern is missing both `format` and `cmd` parameters")};if(!b(t))return n("Raw pattern is not an object");if(!y(t.start))return n("Raw pattern is missing `start` parameter");if(void 0!==t.end){if(!y(t.end))return n("Inline pattern has non-string `end` parameter");if(0===t.start.length&&0===t.end.length)return n("Inline pattern has empty `start` and `end` parameters");var r=t.start,o=t.end;return 0===o.length&&(o=r,r=""),e("Inline",function(t){return{type:"inline-format",start:r,end:o,format:t}},function(t,n){return{type:"inline-command",start:r,end:o,cmd:t,value:n}})}return void 0!==t.replacement?y(t.replacement)?0===t.start.length?n("Replacement pattern has empty `start` parameter"):_.value({type:"inline-command",start:"",end:t.start,cmd:"mceInsertContent",value:t.replacement}):n("Replacement pattern has non-string `replacement` parameter"):0===t.start.length?n("Block pattern has empty `start` parameter"):e("Block",function(n){return{type:"block-format",start:t.start,format:n[0]}},function(n,e){return{type:"block-command",start:t.start,cmd:n,value:e}})},W=function(t){return"block-command"===t.type?{start:t.start,cmd:t.cmd,value:t.value}:"block-format"===t.type?{start:t.start,format:t.format}:"inline-command"===t.type?"mceInsertContent"===t.cmd&&""===t.start?{start:t.end,replacement:t.value}:{start:t.start,end:t.end,cmd:t.cmd,value:t.value}:"inline-format"===t.type?{start:t.start,end:t.end,format:1===t.format.length?t.format[0]:t.format}:void 0},X=function(t){return{inlinePatterns:R(t,U),blockPatterns:L(R(t,q))}},z={get:function(t){return{setPatterns:function(n){var e=j(E(n,V));if(e.errors.length>0){var r=e.errors[0];throw new Error(r.message+":\n"+JSON.stringify(r.pattern,null,2))}t.set(X(e.values))},getPatterns:function(){return function(){for(var t=0,n=0,e=arguments.length;n<e;n++)t+=arguments[n].length;var r=Array(t),o=0;for(n=0;n<e;n++)for(var a=arguments[n],i=0,u=a.length;i<u;i++,o++)r[o]=a[i];return r}(E(t.get().inlinePatterns,W),E(t.get().blockPatterns,W))}}}},F=void 0!==t.window?t.window:Function("return this;")(),G=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var e=F.console;e&&(e.error?e.error.apply(e,t):e.log.apply(e,t))},H=[{start:"*",end:"*",format:"italic"},{start:"**",end:"**",format:"bold"},{start:"#",format:"h1"},{start:"##",format:"h2"},{start:"###",format:"h3"},{start:"####",format:"h4"},{start:"#####",format:"h5"},{start:"######",format:"h6"},{start:"1. ",cmd:"InsertOrderedList"},{start:"* ",cmd:"InsertUnorderedList"},{start:"- ",cmd:"InsertUnorderedList"}],J=function(t){var n,e,r=(n=t,e="textpattern_patterns",A(n,e)?h.from(n[e]):h.none()).getOr(H);if(!k(r))return G("The setting textpattern_patterns should be an array"),{inlinePatterns:[],blockPatterns:[]};var o=j(E(r,V));return T(o.errors,function(t){return G(t.message,t.pattern)}),X(o.values)},K=function(t){var n=t.getParam("forced_root_block","p");return!1===n?"":!0===n?"p":n},Q=tinymce.util.Tools.resolve("tinymce.util.Delay"),Y=tinymce.util.Tools.resolve("tinymce.util.VK"),Z=tinymce.util.Tools.resolve("tinymce.util.Tools"),$=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),tt=function(n){return n.nodeType===t.Node.TEXT_NODE},nt=function(t,n,e){if(n&&t.isEmpty(n)&&!e(n)){var r=n.parentNode;t.remove(n),nt(t,r,e)}},et=function(t,n,e,r){void 0===r&&(r=!0);var o=n.startContainer.parentNode,a=n.endContainer.parentNode;n.deleteContents(),r&&!e(n.startContainer)&&(tt(n.startContainer)&&0===n.startContainer.data.length&&t.remove(n.startContainer),tt(n.endContainer)&&0===n.endContainer.data.length&&t.remove(n.endContainer),nt(t,o,e),o!==a&&nt(t,a,e))},rt=function(t,n){var e,r=n.get(t);return k(r)&&(e=r,0===e.length?h.none():h.some(e[0])).exists(function(t){return A(t,"block")})},ot=function(t){return 0===t.start.length},at=function(t,n){return function(t,n){for(var e=0,r=t.length;e<r;e++){var o=t[e];if(n(o,e))return h.some(o)}return h.none()}(t,function(t){return 0===n.indexOf(t.start)&&(!function(t){return A(t,"end")}(t)||!t.end||n.lastIndexOf(t.end)===n.length-t.end.length)})},it=function(t,n){var e=h.from(t.dom.getParent(n.startContainer,t.dom.isBlock));return""===K(t)?e.orThunk(function(){return h.some(t.getBody())}):e},ut=function(t,n){return{element:t,offset:n}},ft=function(n,e){var r=new $(n,e),o=function(n){for(var e=r[n]();e&&e.nodeType!==t.Node.TEXT_NODE;)e=r[n]();return e&&e.nodeType===t.Node.TEXT_NODE?h.some(e):h.none()};return{next:function(){return o("next")},prev:function(){return o("prev")},prev2:function(){return o("prev2")}}},ct=function(t,n,e){return tt(t)&&n>=0?h.some(ut(t,n)):ft(t,e).prev().map(function(t){return ut(t,t.data.length)})},st=function(t,n,e){if(!tt(t))return h.none();var r=t.textContent;return n>=0&&n<=r.length?h.some(ut(t,n)):ft(t,e).prev().bind(function(t){var r=t.textContent;return st(t,n+r.length,e)})},lt=function(t,n,e){if(!tt(t))return h.none();var r=t.textContent;return n<=r.length?h.some(ut(t,n)):ft(t,e).next().bind(function(t){return lt(t,n-r.length,e)})},dt=I([{aborted:[]},{edge:["element"]},{success:["info"]}]),mt=I([{abort:[]},{kontinue:[]},{finish:["info"]}]),gt=function(t,n,e,r,o,a){var i=function(){return a.fold(dt.aborted,dt.edge)},u=function(){var e=o();return e?gt(t,e,h.none(),r,o,h.some(n)):i()};if(function(t,n){return t.isBlock(n)||C(["BR","IMG","HR","INPUT"],n.nodeName)||"false"===t.getContentEditable(n)}(t,n))return i();if(tt(n)){var f=n.textContent;return r(mt,n,f,e).fold(dt.aborted,function(){return u()},dt.success)}return u()},pt=function(t,n,e){if(tt(n)&&(e<0||e>n.data.length))return[];for(var r=[e],o=n;o!==t&&o.parentNode;){for(var a=o.parentNode,i=0;i<a.childNodes.length;i++)if(a.childNodes[i]===o){r.push(i);break}o=a}return o===t?r.reverse():[]},ht=function(t,n,e,r,o){return{start:pt(t,n,e),end:pt(t,r,o)}},vt=function(t,n){var e,r,o,a=n.slice(),i=a.pop();return(e=a,r=function(t,n){return t.bind(function(t){return h.from(t.childNodes[n])})},o=h.some(t),T(e,function(t){o=r(o,t)}),o).bind(function(t){return tt(t)&&i>=0&&t.data.length,h.some({node:t,offset:i})})},yt=function(n,e){return vt(n,e.start).bind(function(r){var o=r.node,a=r.offset;return vt(n,e.end).map(function(n){var e=n.node,r=n.offset,i=t.document.createRange();return i.setStart(o,a),i.setEnd(e,r),i})})},bt=function(t,n,e){ft(n,n).next().each(function(r){lt(r,e.start.length,n).each(function(e){var o=t.createRng();o.setStart(r,0),o.setEnd(e.element,e.offset),et(t,o,function(t){return t===n})})})},kt=function(t,n){if(0!==n.length){var e=t.selection.getBookmark();T(n,function(n){return function(t,n){var e=t.dom,r=n.pattern,o=yt(e.getRoot(),n.range).getOrDie("Unable to resolve path range");return it(t,o).each(function(n){"block-format"===r.type?rt(r.format,t.formatter)&&t.undoManager.transact(function(){bt(t.dom,n,r),t.formatter.apply(r.format)}):"block-command"===r.type&&t.undoManager.transact(function(){bt(t.dom,n,r),t.execCommand(r.cmd,!1,r.value)})}),!0}(t,n)}),t.selection.moveToBookmark(e)}},Ot=0,wt=function(t,n){return t.create("span",{"data-mce-type":"bookmark",id:n})},xt=function(t,n){var e=t.createRng();return e.setStartAfter(n.start),e.setEndBefore(n.end),e},Ct=function(t,n,e){var r=yt(t.getRoot(),e).getOrDie("Unable to resolve path range"),o=r.startContainer,a=r.endContainer,i=0===r.endOffset?a:a.splitText(r.endOffset),u=0===r.startOffset?o:o.splitText(r.startOffset);return{prefix:n,end:i.parentNode.insertBefore(wt(t,n+"-end"),i),start:u.parentNode.insertBefore(wt(t,n+"-start"),u)}},Et=function(t,n,e){nt(t,t.get(n.prefix+"-end"),e),nt(t,t.get(n.prefix+"-start"),e)},Tt=function(t,n,e,r,o,a){if(void 0===a&&(a=!1),0===n.start.length&&!a){var i=t.createRng();return i.setStart(e,r),i.setEnd(e,r),h.some(i)}return ct(e,r,o).bind(function(e){return function(t,n,e,r,o){var a=new $(n,o);return gt(t,n,h.some(e),r,a.prev,h.none())}(t,e.element,e.offset,function(t,n,e){return function(r,o,a,i){if(o===n)return r.abort();var u=a.substring(0,i.getOr(a.length)),f=u.lastIndexOf(e.charAt(e.length-1)),c=u.lastIndexOf(e);if(-1!==c){var s=t.createRng();return s.setStart(o,c),s.setEnd(o,c+e.length),r.finish(s)}return-1!==f?st(o,f+1-e.length,n).fold(function(){return r.kontinue()},function(n){var a=t.createRng();return a.setStart(n.element,n.offset),a.setEnd(o,f+1),a.toString()===e?r.finish(a):r.kontinue()}):r.kontinue()}}(t,o,n.start),o).fold(h.none,h.none,h.some).bind(function(t){if(a){if(t.endContainer===e.element&&t.endOffset===e.offset)return h.none();if(0===e.offset&&t.endContainer.textContent.length===t.endOffset)return h.none()}return h.some(t)})})},Rt=function(t,n,e){var r=t.dom,o=r.getRoot(),a=e.pattern,i=e.position.element,u=e.position.offset;return st(i,u-e.pattern.end.length,n).bind(function(f){var c=ht(o,f.element,f.offset,i,u);if(ot(a))return h.some({matches:[{pattern:a,startRng:c,endRng:c}],position:f});var s=Nt(t,e.remainingPatterns,f.element,f.offset,n),l=s.getOr({matches:[],position:f}),d=l.position;return Tt(r,a,d.element,d.offset,n,s.isNone()).map(function(t){var n=function(t,n){return ht(t,n.startContainer,n.startOffset,n.endContainer,n.endOffset)}(o,t);return{matches:l.matches.concat([{pattern:a,startRng:n,endRng:c}]),position:ut(t.startContainer,t.startOffset)}})})},Nt=function(t,n,e,r,o){var a=t.dom;return ct(e,r,a.getRoot()).bind(function(i){var u=a.createRng();u.setStart(o,0),u.setEnd(e,r);for(var f,c,s=u.toString(),l=0;l<n.length;l++){var d=n[l];if(f=s,c=d.end,function(t,n,e){return""===n||!(t.length<n.length)&&t.substr(e,e+n.length)===n}(f,c,f.length-c.length)){var m=n.slice();m.splice(l,1);var g=Rt(t,o,{pattern:d,remainingPatterns:m,position:i});if(g.isSome())return g}}return h.none()})},Pt=function(t,n,e){t.selection.setRng(e),"inline-format"===n.type?T(n.format,function(n){t.formatter.apply(n)}):t.execCommand(n.cmd,!1,n.value)},St=function(t,n){var e,o,a=(e="mce_textpattern",o=(new Date).getTime(),e+"_"+Math.floor(1e9*Math.random())+ ++Ot+String(o)),i=N(n,function(n,e){var o=Ct(t,a+"_end"+n.length,e.endRng);return n.concat([r(r({},e),{endMarker:o})])},[]);return N(i,function(n,e){var o=i.length-n.length-1,u=ot(e.pattern)?e.endMarker:Ct(t,a+"_start"+o,e.startRng);return n.concat([r(r({},e),{startMarker:u})])},[])},Mt=function(t,n,e){var r=t.selection.getRng();return!1===r.collapsed?[]:it(t,r).bind(function(o){var a=r.startOffset-(e?1:0);return Nt(t,n,r.startContainer,a,o)}).fold(function(){return[]},function(t){return t.matches})},At=function(t,n){if(0!==n.length){var e=t.dom,r=t.selection.getBookmark(),o=St(e,n);T(o,function(n){var r=e.getParent(n.startMarker.start,e.isBlock),o=function(t){return t===r};ot(n.pattern)?function(t,n,e,r){var o=xt(t.dom,e);et(t.dom,o,r),Pt(t,n,o)}(t,n.pattern,n.endMarker,o):function(t,n,e,r,o){var a=t.dom,i=xt(a,r),u=xt(a,e);et(a,u,o),et(a,i,o);var f={prefix:e.prefix,start:e.end,end:r.start},c=xt(a,f);Pt(t,n,c)}(t,n.pattern,n.startMarker,n.endMarker,o),Et(e,n.endMarker,o),Et(e,n.startMarker,o)}),t.selection.moveToBookmark(r)}},It=function(t,n,e){for(var r=0;r<t.length;r++)if(e(t[r],n))return!0},jt=function(t,n){if(!t.selection.isCollapsed())return!1;var e=Mt(t,n.inlinePatterns,!1),r=function(t,n){var e=t.dom,r=t.selection.getRng();return it(t,r).filter(function(n){var r=K(t),o=""===r&&e.is(n,"body")||e.is(n,r);return null!==n&&o}).bind(function(t){var r=t.textContent;return at(n,r).map(function(n){return Z.trim(r).length===n.start.length?[]:[{pattern:n,range:ht(e.getRoot(),t,0,t,0)}]})}).getOr([])}(t,n.blockPatterns);return(r.length>0||e.length>0)&&(t.undoManager.add(),t.undoManager.extra(function(){t.execCommand("mceInsertNewLine")},function(){t.insertContent("\ufeff"),At(t,e),kt(t,r);var n=t.selection.getRng(),o=ct(n.startContainer,n.startOffset,t.dom.getRoot());t.execCommand("mceInsertNewLine"),o.each(function(n){"\ufeff"===n.element.data.charAt(n.offset-1)&&(n.element.deleteData(n.offset-1,1),nt(t.dom,n.element.parentNode,function(n){return n===t.dom.getRoot()}))})}),!0)},Bt=function(t,n){var e=Mt(t,n.inlinePatterns,!0);e.length>0&&t.undoManager.transact(function(){At(t,e)})},Dt=function(t,n){return It(t,n,function(t,n){return t.charCodeAt(0)===n.charCode})},_t=function(t,n){return It(t,n,function(t,n){return t===n.keyCode&&!1===Y.modifierPressed(n)})},Ut={setup:function(t,n){var e=[",",".",";",":","!","?"],r=[32];t.on("keydown",function(e){13!==e.keyCode||Y.modifierPressed(e)||jt(t,n.get())&&e.preventDefault()},!0),t.on("keyup",function(e){_t(r,e)&&Bt(t,n.get())}),t.on("keypress",function(r){Dt(e,r)&&Q.setEditorTimeout(t,function(){Bt(t,n.get())})})}};e.add("textpattern",function(t){var e=n(J(t.settings));return Ut.setup(t,e),z.get(e)})}(window);
//# sourceMappingURL=plugin.js.map
