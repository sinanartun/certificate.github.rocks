{"version":3,"sources":["media/plugin.js"],"names":["eq","call","id","me","merger","global","tinymce","util","Tools","resolve","__assign","Object","assign","t","s","i","n","arguments","length","p","prototype","hasOwnProperty","apply","this","noop","constant","value","never","always","none","NONE","o","isNone","fold","is","isSome","getOr","getOrThunk","thunk","getOrDie","msg","Error","getOrNull","getOrUndefined","undefined","or","orThunk","map","each","bind","exists","forall","filter","equals","equals_","toArray","toString","freeze","some","a","constant_a","self","f","v","elementEq","b","Option","isType","type","x","Array","isPrototypeOf","constructor","name","String","typeOf","isString","isArray","isFunction","nativeSlice","slice","nativePush","push","xs","len","flatten","r","Cell","from","initial","get","set","clone","merge","old","nu","objects","ret","j","curObject","key","hasOwnProperty$1","obj","has","Settings","editor","getParam","global$1","global$2","global$3","getSize","elm","style","replace","setSize","test","addPx","Size","getMaxWidth","getMaxHeight","setMaxWidth","setMaxHeight","getVideoScriptMatch","prefixes","src","indexOf","DOM","getEphoxEmbedIri","getAttrib","htmlToData","html","fragment","createFragment","firstChild","isEphoxEmbed","div","source1","source2","poster","width","height","ephoxEmbedHtmlToData","data","validate","allow_conditional_comments","start","attrs","movie","extend","videoScript","parse","htmlToDataSax","global$4","Mime","url","mime","mp3","m4a","wav","mp4","webm","ogg","swf","toLowerCase","split","pop","global$5","global$6","DOM$1","setAttributes","updatedAttrs","attr","splice","updateEphoxEmbed","writer","getContent","normalizeHtml","outerHTML","UpdateHtml","updateAll","isEphoxEmbed$1","hasImage","sourceCount","comment","text","cdata","raw","empty","end","index","imgAttrs","updateHtmlSax","urlPatterns","regex","w","h","allowFullscreen","getUrl","pattern","match","exec","newUrl","_loop_1","dataToHtml","dataIn","embed","convertURL","source1mime","source2mime","matchPattern","audioTemplateCallback","videoTemplateCallback","dom","encode","getIframeHtml","getFlashHtml","getAudioHtml","getScriptHtml","getVideoHtml","cache","loadedData","Service","embedHandler","handler","res","rej","wrappedResolve","response","embedPromise","defaultPromise","unwrap","unwrapped","dimensions","prop","wrap","wrapped","handleError","error","errorMessage","notificationManager","open","snippetToData","embedSnippet","addEmbedHtml","api","trim","snippetData","nuData","setData","handleInsert","beforeObjects","select","insertContent","afterObjects","y","selection","selectPlaceholder","nodeChanged","Dialog","editorData","element","getNode","snippet","getAttribute","isMediaElement","serializer","serialize","getEditorData","currentData","initialData","getSourceData","getData","sizeInput","label","constrain","generalTab","title","items","filetype","embedTab","advancedFormItems","advancedTab","tabs","body","win","windowManager","size","buttons","primary","onSubmit","serviceData","prevData","newData","then","catch","submitForm","close","onChange","detail","handleSource1","dataFromEmbed","handleEmbed","handleUpdate","Api","showDialog","Commands","register","addCommand","global$7","global$8","Sanitize","blocked","serializeStyle","parseStyle","createPlaceholderNode","node","placeHolder","shortEnded","retainAttributesAndInnerHtml","transparentSrc","data-mce-object","class","createPreviewIframeNode","previewWrapper","previewNode","shimNode","contentEditable","allowfullscreen","frameborder","append","sourceNode","targetNode","attrName","attrValue","attribs","ai","innerHtml","attributes","escape","isPageEmbedWrapper","nodeClass","isWithinEmbedWrapper","parent","Nodes","nodes","ceFalse","FilterContent","setup","on","specialElements","schema","getSpecialElements","RegExp","boolAttrs","getBoolAttrs","parser","addNodeFilter","addAttributeFilter","realElm","innerNode","realElmName","className","substr","unescape","$","$elm","find","ResolveName","e","target","nodeType","Selection","selectedNode","hasClass","setAttribute","objectType","preventDefault","stateSelectorAdapter","selector","buttonApi","selectorChangedWithUnbind","join","setActive","unbind","Buttons","ui","registry","addToggleButton","tooltip","icon","onAction","execCommand","onSetup","addMenuItem","add"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.1.0 (2019-10-17)\n */\n(function () {\n    'use strict';\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var __assign = function () {\n      __assign = Object.assign || function __assign(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n          s = arguments[i];\n          for (var p in s)\n            if (Object.prototype.hasOwnProperty.call(s, p))\n              t[p] = s[p];\n        }\n        return t;\n      };\n      return __assign.apply(this, arguments);\n    };\n\n    var noop = function () {\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      if (Object.freeze) {\n        Object.freeze(me);\n      }\n      return me;\n    }();\n    var some = function (a) {\n      var constant_a = constant(a);\n      var self = function () {\n        return me;\n      };\n      var bind = function (f) {\n        return f(a);\n      };\n      var me = {\n        fold: function (n, s) {\n          return s(a);\n        },\n        is: function (v) {\n          return a === v;\n        },\n        isSome: always,\n        isNone: never,\n        getOr: constant_a,\n        getOrThunk: constant_a,\n        getOrDie: constant_a,\n        getOrNull: constant_a,\n        getOrUndefined: constant_a,\n        or: self,\n        orThunk: self,\n        map: function (f) {\n          return some(f(a));\n        },\n        each: function (f) {\n          f(a);\n        },\n        bind: bind,\n        exists: bind,\n        forall: bind,\n        filter: function (f) {\n          return f(a) ? me : NONE;\n        },\n        toArray: function () {\n          return [a];\n        },\n        toString: function () {\n          return 'some(' + a + ')';\n        },\n        equals: function (o) {\n          return o.is(a);\n        },\n        equals_: function (o, elementEq) {\n          return o.fold(never, function (b) {\n            return elementEq(a, b);\n          });\n        }\n      };\n      return me;\n    };\n    var from = function (value) {\n      return value === null || value === undefined ? NONE : some(value);\n    };\n    var Option = {\n      some: some,\n      none: none,\n      from: from\n    };\n\n    var typeOf = function (x) {\n      if (x === null) {\n        return 'null';\n      }\n      var t = typeof x;\n      if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      }\n      if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      }\n      return t;\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isString = isType('string');\n    var isArray = isType('array');\n    var isFunction = isType('function');\n\n    var nativeSlice = Array.prototype.slice;\n    var nativePush = Array.prototype.push;\n    var each = function (xs, f) {\n      for (var i = 0, len = xs.length; i < len; i++) {\n        var x = xs[i];\n        f(x, i);\n      }\n    };\n    var flatten = function (xs) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        if (!isArray(xs[i])) {\n          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n        }\n        nativePush.apply(r, xs[i]);\n      }\n      return r;\n    };\n    var from$1 = isFunction(Array.from) ? Array.from : function (x) {\n      return nativeSlice.call(x);\n    };\n\n    var Cell = function (initial) {\n      var value = initial;\n      var get = function () {\n        return value;\n      };\n      var set = function (v) {\n        value = v;\n      };\n      var clone = function () {\n        return Cell(get());\n      };\n      return {\n        get: get,\n        set: set,\n        clone: clone\n      };\n    };\n\n    var hasOwnProperty = Object.prototype.hasOwnProperty;\n    var shallow = function (old, nu) {\n      return nu;\n    };\n    var baseMerge = function (merger) {\n      return function () {\n        var objects = new Array(arguments.length);\n        for (var i = 0; i < objects.length; i++) {\n          objects[i] = arguments[i];\n        }\n        if (objects.length === 0) {\n          throw new Error('Can\\'t merge zero objects');\n        }\n        var ret = {};\n        for (var j = 0; j < objects.length; j++) {\n          var curObject = objects[j];\n          for (var key in curObject) {\n            if (hasOwnProperty.call(curObject, key)) {\n              ret[key] = merger(ret[key], curObject[key]);\n            }\n          }\n        }\n        return ret;\n      };\n    };\n    var merge = baseMerge(shallow);\n\n    var hasOwnProperty$1 = Object.hasOwnProperty;\n    var get = function (obj, key) {\n      return has(obj, key) ? Option.from(obj[key]) : Option.none();\n    };\n    var has = function (obj, key) {\n      return hasOwnProperty$1.call(obj, key);\n    };\n\n    var getScripts = function (editor) {\n      return editor.getParam('media_scripts');\n    };\n    var getAudioTemplateCallback = function (editor) {\n      return editor.getParam('audio_template_callback');\n    };\n    var getVideoTemplateCallback = function (editor) {\n      return editor.getParam('video_template_callback');\n    };\n    var hasLiveEmbeds = function (editor) {\n      return editor.getParam('media_live_embeds', true);\n    };\n    var shouldFilterHtml = function (editor) {\n      return editor.getParam('media_filter_html', true);\n    };\n    var getUrlResolver = function (editor) {\n      return editor.getParam('media_url_resolver');\n    };\n    var hasAltSource = function (editor) {\n      return editor.getParam('media_alt_source', true);\n    };\n    var hasPoster = function (editor) {\n      return editor.getParam('media_poster', true);\n    };\n    var hasDimensions = function (editor) {\n      return editor.getParam('media_dimensions', true);\n    };\n    var Settings = {\n      getScripts: getScripts,\n      getAudioTemplateCallback: getAudioTemplateCallback,\n      getVideoTemplateCallback: getVideoTemplateCallback,\n      hasLiveEmbeds: hasLiveEmbeds,\n      shouldFilterHtml: shouldFilterHtml,\n      getUrlResolver: getUrlResolver,\n      hasAltSource: hasAltSource,\n      hasPoster: hasPoster,\n      hasDimensions: hasDimensions\n    };\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.html.SaxParser');\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n\n    var trimPx = function (value) {\n      return value.replace(/px$/, '');\n    };\n    var addPx = function (value) {\n      return /^[0-9.]+$/.test(value) ? value + 'px' : value;\n    };\n    var getSize = function (name) {\n      return function (elm) {\n        return elm ? trimPx(elm.style[name]) : '';\n      };\n    };\n    var setSize = function (name) {\n      return function (elm, value) {\n        if (elm) {\n          elm.style[name] = addPx(value);\n        }\n      };\n    };\n    var Size = {\n      getMaxWidth: getSize('maxWidth'),\n      getMaxHeight: getSize('maxHeight'),\n      setMaxWidth: setSize('maxWidth'),\n      setMaxHeight: setSize('maxHeight')\n    };\n\n    var getVideoScriptMatch = function (prefixes, src) {\n      if (prefixes) {\n        for (var i = 0; i < prefixes.length; i++) {\n          if (src.indexOf(prefixes[i].filter) !== -1) {\n            return prefixes[i];\n          }\n        }\n      }\n    };\n\n    var DOM = global$3.DOM;\n    var getEphoxEmbedIri = function (elm) {\n      return DOM.getAttrib(elm, 'data-ephox-embed-iri');\n    };\n    var isEphoxEmbed = function (html) {\n      var fragment = DOM.createFragment(html);\n      return getEphoxEmbedIri(fragment.firstChild) !== '';\n    };\n    var htmlToDataSax = function (prefixes, html) {\n      var data = {};\n      global$2({\n        validate: false,\n        allow_conditional_comments: true,\n        start: function (name, attrs) {\n          if (!data.source1 && name === 'param') {\n            data.source1 = attrs.map.movie;\n          }\n          if (name === 'iframe' || name === 'object' || name === 'embed' || name === 'video' || name === 'audio') {\n            if (!data.type) {\n              data.type = name;\n            }\n            data = global$1.extend(attrs.map, data);\n          }\n          if (name === 'script') {\n            var videoScript = getVideoScriptMatch(prefixes, attrs.map.src);\n            if (!videoScript) {\n              return;\n            }\n            data = {\n              type: 'script',\n              source1: attrs.map.src,\n              width: String(videoScript.width),\n              height: String(videoScript.height)\n            };\n          }\n          if (name === 'source') {\n            if (!data.source1) {\n              data.source1 = attrs.map.src;\n            } else if (!data.source2) {\n              data.source2 = attrs.map.src;\n            }\n          }\n          if (name === 'img' && !data.poster) {\n            data.poster = attrs.map.src;\n          }\n        }\n      }).parse(html);\n      data.source1 = data.source1 || data.src || data.data;\n      data.source2 = data.source2 || '';\n      data.poster = data.poster || '';\n      return data;\n    };\n    var ephoxEmbedHtmlToData = function (html) {\n      var fragment = DOM.createFragment(html);\n      var div = fragment.firstChild;\n      return {\n        type: 'ephox-embed-iri',\n        source1: getEphoxEmbedIri(div),\n        source2: '',\n        poster: '',\n        width: Size.getMaxWidth(div),\n        height: Size.getMaxHeight(div)\n      };\n    };\n    var htmlToData = function (prefixes, html) {\n      return isEphoxEmbed(html) ? ephoxEmbedHtmlToData(html) : htmlToDataSax(prefixes, html);\n    };\n\n    var global$4 = tinymce.util.Tools.resolve('tinymce.util.Promise');\n\n    var guess = function (url) {\n      var mimes = {\n        mp3: 'audio/mpeg',\n        m4a: 'audio/x-m4a',\n        wav: 'audio/wav',\n        mp4: 'video/mp4',\n        webm: 'video/webm',\n        ogg: 'video/ogg',\n        swf: 'application/x-shockwave-flash'\n      };\n      var fileEnd = url.toLowerCase().split('.').pop();\n      var mime = mimes[fileEnd];\n      return mime ? mime : '';\n    };\n    var Mime = { guess: guess };\n\n    var global$5 = tinymce.util.Tools.resolve('tinymce.html.Writer');\n\n    var global$6 = tinymce.util.Tools.resolve('tinymce.html.Schema');\n\n    var DOM$1 = global$3.DOM;\n    var setAttributes = function (attrs, updatedAttrs) {\n      var name;\n      var i;\n      var value;\n      var attr;\n      for (name in updatedAttrs) {\n        value = '' + updatedAttrs[name];\n        if (attrs.map[name]) {\n          i = attrs.length;\n          while (i--) {\n            attr = attrs[i];\n            if (attr.name === name) {\n              if (value) {\n                attrs.map[name] = value;\n                attr.value = value;\n              } else {\n                delete attrs.map[name];\n                attrs.splice(i, 1);\n              }\n            }\n          }\n        } else if (value) {\n          attrs.push({\n            name: name,\n            value: value\n          });\n          attrs.map[name] = value;\n        }\n      }\n    };\n    var normalizeHtml = function (html) {\n      var writer = global$5();\n      var parser = global$2(writer);\n      parser.parse(html);\n      return writer.getContent();\n    };\n    var updateHtmlSax = function (html, data, updateAll) {\n      var writer = global$5();\n      var sourceCount = 0;\n      var hasImage;\n      global$2({\n        validate: false,\n        allow_conditional_comments: true,\n        comment: function (text) {\n          writer.comment(text);\n        },\n        cdata: function (text) {\n          writer.cdata(text);\n        },\n        text: function (text, raw) {\n          writer.text(text, raw);\n        },\n        start: function (name, attrs, empty) {\n          switch (name) {\n          case 'video':\n          case 'object':\n          case 'embed':\n          case 'img':\n          case 'iframe':\n            if (data.height !== undefined && data.width !== undefined) {\n              setAttributes(attrs, {\n                width: data.width,\n                height: data.height\n              });\n            }\n            break;\n          }\n          if (updateAll) {\n            switch (name) {\n            case 'video':\n              setAttributes(attrs, {\n                poster: data.poster,\n                src: ''\n              });\n              if (data.source2) {\n                setAttributes(attrs, { src: '' });\n              }\n              break;\n            case 'iframe':\n              setAttributes(attrs, { src: data.source1 });\n              break;\n            case 'source':\n              sourceCount++;\n              if (sourceCount <= 2) {\n                setAttributes(attrs, {\n                  src: data['source' + sourceCount],\n                  type: data['source' + sourceCount + 'mime']\n                });\n                if (!data['source' + sourceCount]) {\n                  return;\n                }\n              }\n              break;\n            case 'img':\n              if (!data.poster) {\n                return;\n              }\n              hasImage = true;\n              break;\n            }\n          }\n          writer.start(name, attrs, empty);\n        },\n        end: function (name) {\n          if (name === 'video' && updateAll) {\n            for (var index = 1; index <= 2; index++) {\n              if (data['source' + index]) {\n                var attrs = [];\n                attrs.map = {};\n                if (sourceCount < index) {\n                  setAttributes(attrs, {\n                    src: data['source' + index],\n                    type: data['source' + index + 'mime']\n                  });\n                  writer.start('source', attrs, true);\n                }\n              }\n            }\n          }\n          if (data.poster && name === 'object' && updateAll && !hasImage) {\n            var imgAttrs = [];\n            imgAttrs.map = {};\n            setAttributes(imgAttrs, {\n              src: data.poster,\n              width: data.width,\n              height: data.height\n            });\n            writer.start('img', imgAttrs, true);\n          }\n          writer.end(name);\n        }\n      }, global$6({})).parse(html);\n      return writer.getContent();\n    };\n    var isEphoxEmbed$1 = function (html) {\n      var fragment = DOM$1.createFragment(html);\n      return DOM$1.getAttrib(fragment.firstChild, 'data-ephox-embed-iri') !== '';\n    };\n    var updateEphoxEmbed = function (html, data) {\n      var fragment = DOM$1.createFragment(html);\n      var div = fragment.firstChild;\n      Size.setMaxWidth(div, data.width);\n      Size.setMaxHeight(div, data.height);\n      return normalizeHtml(div.outerHTML);\n    };\n    var updateHtml = function (html, data, updateAll) {\n      return isEphoxEmbed$1(html) ? updateEphoxEmbed(html, data) : updateHtmlSax(html, data, updateAll);\n    };\n    var UpdateHtml = { updateHtml: updateHtml };\n\n    var urlPatterns = [\n      {\n        regex: /youtu\\.be\\/([\\w\\-_\\?&=.]+)/i,\n        type: 'iframe',\n        w: 560,\n        h: 314,\n        url: '//www.youtube.com/embed/$1',\n        allowFullscreen: true\n      },\n      {\n        regex: /youtube\\.com(.+)v=([^&]+)(&([a-z0-9&=\\-_]+))?/i,\n        type: 'iframe',\n        w: 560,\n        h: 314,\n        url: '//www.youtube.com/embed/$2?$4',\n        allowFullscreen: true\n      },\n      {\n        regex: /youtube.com\\/embed\\/([a-z0-9\\?&=\\-_]+)/i,\n        type: 'iframe',\n        w: 560,\n        h: 314,\n        url: '//www.youtube.com/embed/$1',\n        allowFullscreen: true\n      },\n      {\n        regex: /vimeo\\.com\\/([0-9]+)/,\n        type: 'iframe',\n        w: 425,\n        h: 350,\n        url: '//player.vimeo.com/video/$1?title=0&byline=0&portrait=0&color=8dc7dc',\n        allowFullscreen: true\n      },\n      {\n        regex: /vimeo\\.com\\/(.*)\\/([0-9]+)/,\n        type: 'iframe',\n        w: 425,\n        h: 350,\n        url: '//player.vimeo.com/video/$2?title=0&amp;byline=0',\n        allowFullscreen: true\n      },\n      {\n        regex: /maps\\.google\\.([a-z]{2,3})\\/maps\\/(.+)msid=(.+)/,\n        type: 'iframe',\n        w: 425,\n        h: 350,\n        url: '//maps.google.com/maps/ms?msid=$2&output=embed\"',\n        allowFullscreen: false\n      },\n      {\n        regex: /dailymotion\\.com\\/video\\/([^_]+)/,\n        type: 'iframe',\n        w: 480,\n        h: 270,\n        url: '//www.dailymotion.com/embed/video/$1',\n        allowFullscreen: true\n      },\n      {\n        regex: /dai\\.ly\\/([^_]+)/,\n        type: 'iframe',\n        w: 480,\n        h: 270,\n        url: '//www.dailymotion.com/embed/video/$1',\n        allowFullscreen: true\n      }\n    ];\n    var getUrl = function (pattern, url) {\n      var match = pattern.regex.exec(url);\n      var newUrl = pattern.url;\n      var _loop_1 = function (i) {\n        newUrl = newUrl.replace('$' + i, function () {\n          return match[i] ? match[i] : '';\n        });\n      };\n      for (var i = 0; i < match.length; i++) {\n        _loop_1(i);\n      }\n      return newUrl.replace(/\\?$/, '');\n    };\n    var matchPattern = function (url) {\n      var pattern = urlPatterns.filter(function (pattern) {\n        return pattern.regex.test(url);\n      });\n      if (pattern.length > 0) {\n        return global$1.extend({}, pattern[0], { url: getUrl(pattern[0], url) });\n      } else {\n        return null;\n      }\n    };\n\n    var getIframeHtml = function (data) {\n      var allowFullscreen = data.allowFullscreen ? ' allowFullscreen=\"1\"' : '';\n      return '<iframe src=\"' + data.source1 + '\" width=\"' + data.width + '\" height=\"' + data.height + '\"' + allowFullscreen + '></iframe>';\n    };\n    var getFlashHtml = function (data) {\n      var html = '<object data=\"' + data.source1 + '\" width=\"' + data.width + '\" height=\"' + data.height + '\" type=\"application/x-shockwave-flash\">';\n      if (data.poster) {\n        html += '<img src=\"' + data.poster + '\" width=\"' + data.width + '\" height=\"' + data.height + '\" />';\n      }\n      html += '</object>';\n      return html;\n    };\n    var getAudioHtml = function (data, audioTemplateCallback) {\n      if (audioTemplateCallback) {\n        return audioTemplateCallback(data);\n      } else {\n        return '<audio controls=\"controls\" src=\"' + data.source1 + '\">' + (data.source2 ? '\\n<source src=\"' + data.source2 + '\"' + (data.source2mime ? ' type=\"' + data.source2mime + '\"' : '') + ' />\\n' : '') + '</audio>';\n      }\n    };\n    var getVideoHtml = function (data, videoTemplateCallback) {\n      if (videoTemplateCallback) {\n        return videoTemplateCallback(data);\n      } else {\n        return '<video width=\"' + data.width + '\" height=\"' + data.height + '\"' + (data.poster ? ' poster=\"' + data.poster + '\"' : '') + ' controls=\"controls\">\\n' + '<source src=\"' + data.source1 + '\"' + (data.source1mime ? ' type=\"' + data.source1mime + '\"' : '') + ' />\\n' + (data.source2 ? '<source src=\"' + data.source2 + '\"' + (data.source2mime ? ' type=\"' + data.source2mime + '\"' : '') + ' />\\n' : '') + '</video>';\n      }\n    };\n    var getScriptHtml = function (data) {\n      return '<script src=\"' + data.source1 + '\"></script>';\n    };\n    var dataToHtml = function (editor, dataIn) {\n      var data = global$1.extend({}, dataIn);\n      if (!data.source1) {\n        global$1.extend(data, htmlToData(Settings.getScripts(editor), data.embed));\n        if (!data.source1) {\n          return '';\n        }\n      }\n      if (!data.source2) {\n        data.source2 = '';\n      }\n      if (!data.poster) {\n        data.poster = '';\n      }\n      data.source1 = editor.convertURL(data.source1, 'source');\n      data.source2 = editor.convertURL(data.source2, 'source');\n      data.source1mime = Mime.guess(data.source1);\n      data.source2mime = Mime.guess(data.source2);\n      data.poster = editor.convertURL(data.poster, 'poster');\n      var pattern = matchPattern(data.source1);\n      if (pattern) {\n        data.source1 = pattern.url;\n        data.type = pattern.type;\n        data.allowFullscreen = pattern.allowFullscreen;\n        data.width = data.width || String(pattern.w);\n        data.height = data.height || String(pattern.h);\n      }\n      if (data.embed) {\n        return UpdateHtml.updateHtml(data.embed, data, true);\n      } else {\n        var videoScript = getVideoScriptMatch(Settings.getScripts(editor), data.source1);\n        if (videoScript) {\n          data.type = 'script';\n          data.width = String(videoScript.width);\n          data.height = String(videoScript.height);\n        }\n        var audioTemplateCallback = Settings.getAudioTemplateCallback(editor);\n        var videoTemplateCallback = Settings.getVideoTemplateCallback(editor);\n        data.width = data.width || '300';\n        data.height = data.height || '150';\n        global$1.each(data, function (value, key) {\n          data[key] = editor.dom.encode('' + value);\n        });\n        if (data.type === 'iframe') {\n          return getIframeHtml(data);\n        } else if (data.source1mime === 'application/x-shockwave-flash') {\n          return getFlashHtml(data);\n        } else if (data.source1mime.indexOf('audio') !== -1) {\n          return getAudioHtml(data, audioTemplateCallback);\n        } else if (data.type === 'script') {\n          return getScriptHtml(data);\n        } else {\n          return getVideoHtml(data, videoTemplateCallback);\n        }\n      }\n    };\n\n    var cache = {};\n    var embedPromise = function (data, dataToHtml, handler) {\n      return new global$4(function (res, rej) {\n        var wrappedResolve = function (response) {\n          if (response.html) {\n            cache[data.source1] = response;\n          }\n          return res({\n            url: data.source1,\n            html: response.html ? response.html : dataToHtml(data)\n          });\n        };\n        if (cache[data.source1]) {\n          wrappedResolve(cache[data.source1]);\n        } else {\n          handler({ url: data.source1 }, wrappedResolve, rej);\n        }\n      });\n    };\n    var defaultPromise = function (data, dataToHtml) {\n      return new global$4(function (res) {\n        res({\n          html: dataToHtml(data),\n          url: data.source1\n        });\n      });\n    };\n    var loadedData = function (editor) {\n      return function (data) {\n        return dataToHtml(editor, data);\n      };\n    };\n    var getEmbedHtml = function (editor, data) {\n      var embedHandler = Settings.getUrlResolver(editor);\n      return embedHandler ? embedPromise(data, loadedData(editor), embedHandler) : defaultPromise(data, loadedData(editor));\n    };\n    var isCached = function (url) {\n      return cache.hasOwnProperty(url);\n    };\n    var Service = {\n      getEmbedHtml: getEmbedHtml,\n      isCached: isCached\n    };\n\n    var unwrap = function (data) {\n      var unwrapped = merge(data, {\n        source1: data.source1.value,\n        source2: get(data, 'source2').bind(function (source2) {\n          return get(source2, 'value');\n        }).getOr(''),\n        poster: get(data, 'poster').bind(function (poster) {\n          return get(poster, 'value');\n        }).getOr('')\n      });\n      get(data, 'dimensions').each(function (dimensions) {\n        each([\n          'width',\n          'height'\n        ], function (prop) {\n          get(dimensions, prop).each(function (value) {\n            return unwrapped[prop] = value;\n          });\n        });\n      });\n      return unwrapped;\n    };\n    var wrap = function (data) {\n      var wrapped = merge(data, {\n        source1: { value: get(data, 'source1').getOr('') },\n        source2: { value: get(data, 'source2').getOr('') },\n        poster: { value: get(data, 'poster').getOr('') }\n      });\n      each([\n        'width',\n        'height'\n      ], function (prop) {\n        get(data, prop).each(function (value) {\n          var dimensions = wrapped.dimensions || {};\n          dimensions[prop] = value;\n          wrapped.dimensions = dimensions;\n        });\n      });\n      return wrapped;\n    };\n    var handleError = function (editor) {\n      return function (error) {\n        var errorMessage = error && error.msg ? 'Media embed handler error: ' + error.msg : 'Media embed handler threw unknown error.';\n        editor.notificationManager.open({\n          type: 'error',\n          text: errorMessage\n        });\n      };\n    };\n    var snippetToData = function (editor, embedSnippet) {\n      return htmlToData(Settings.getScripts(editor), embedSnippet);\n    };\n    var isMediaElement = function (element) {\n      return element.getAttribute('data-mce-object') || element.getAttribute('data-ephox-embed-iri');\n    };\n    var getEditorData = function (editor) {\n      var element = editor.selection.getNode();\n      var snippet = isMediaElement(element) ? editor.serializer.serialize(element, { selection: true }) : '';\n      return merge({ embed: snippet }, htmlToData(Settings.getScripts(editor), snippet));\n    };\n    var addEmbedHtml = function (api, editor) {\n      return function (response) {\n        if (isString(response.url) && response.url.trim().length > 0) {\n          var html = response.html;\n          var snippetData = snippetToData(editor, html);\n          var nuData = __assign(__assign({}, snippetData), {\n            source1: response.url,\n            embed: html\n          });\n          api.setData(wrap(nuData));\n        }\n      };\n    };\n    var selectPlaceholder = function (editor, beforeObjects) {\n      var afterObjects = editor.dom.select('img[data-mce-object]');\n      for (var i = 0; i < beforeObjects.length; i++) {\n        for (var y = afterObjects.length - 1; y >= 0; y--) {\n          if (beforeObjects[i] === afterObjects[y]) {\n            afterObjects.splice(y, 1);\n          }\n        }\n      }\n      editor.selection.select(afterObjects[0]);\n    };\n    var handleInsert = function (editor, html) {\n      var beforeObjects = editor.dom.select('img[data-mce-object]');\n      editor.insertContent(html);\n      selectPlaceholder(editor, beforeObjects);\n      editor.nodeChanged();\n    };\n    var submitForm = function (prevData, newData, editor) {\n      newData.embed = UpdateHtml.updateHtml(newData.embed, newData);\n      if (newData.embed && (prevData.source1 === newData.source1 || Service.isCached(newData.source1))) {\n        handleInsert(editor, newData.embed);\n      } else {\n        Service.getEmbedHtml(editor, newData).then(function (response) {\n          handleInsert(editor, response.html);\n        }).catch(handleError(editor));\n      }\n    };\n    var showDialog = function (editor) {\n      var editorData = getEditorData(editor);\n      var currentData = Cell(editorData);\n      var initialData = wrap(editorData);\n      var getSourceData = function (api) {\n        return unwrap(api.getData());\n      };\n      var handleSource1 = function (prevData, api) {\n        var serviceData = getSourceData(api);\n        if (prevData.source1 !== serviceData.source1) {\n          addEmbedHtml(win, editor)({\n            url: serviceData.source1,\n            html: ''\n          });\n          Service.getEmbedHtml(editor, serviceData).then(addEmbedHtml(win, editor)).catch(handleError(editor));\n        }\n      };\n      var handleEmbed = function (api) {\n        var data = unwrap(api.getData());\n        var dataFromEmbed = snippetToData(editor, data.embed);\n        api.setData(wrap(dataFromEmbed));\n      };\n      var handleUpdate = function (api) {\n        var data = getSourceData(api);\n        var embed = dataToHtml(editor, data);\n        api.setData(wrap(__assign(__assign({}, data), { embed: embed })));\n      };\n      var mediaInput = [{\n          name: 'source1',\n          type: 'urlinput',\n          filetype: 'media',\n          label: 'Source'\n        }];\n      var sizeInput = !Settings.hasDimensions(editor) ? [] : [{\n          type: 'sizeinput',\n          name: 'dimensions',\n          label: 'Constrain proportions',\n          constrain: true\n        }];\n      var generalTab = {\n        title: 'General',\n        name: 'general',\n        items: flatten([\n          mediaInput,\n          sizeInput\n        ])\n      };\n      var embedTextarea = {\n        type: 'textarea',\n        name: 'embed',\n        label: 'Paste your embed code below:'\n      };\n      var embedTab = {\n        title: 'Embed',\n        items: [embedTextarea]\n      };\n      var advancedFormItems = [];\n      if (Settings.hasAltSource(editor)) {\n        advancedFormItems.push({\n          name: 'source2',\n          type: 'urlinput',\n          filetype: 'media',\n          label: 'Alternative source URL'\n        });\n      }\n      if (Settings.hasPoster(editor)) {\n        advancedFormItems.push({\n          name: 'poster',\n          type: 'urlinput',\n          filetype: 'image',\n          label: 'Media poster (Image URL)'\n        });\n      }\n      var advancedTab = {\n        title: 'Advanced',\n        name: 'advanced',\n        items: advancedFormItems\n      };\n      var tabs = [\n        generalTab,\n        embedTab\n      ];\n      if (advancedFormItems.length > 0) {\n        tabs.push(advancedTab);\n      }\n      var body = {\n        type: 'tabpanel',\n        tabs: tabs\n      };\n      var win = editor.windowManager.open({\n        title: 'Insert/Edit Media',\n        size: 'normal',\n        body: body,\n        buttons: [\n          {\n            type: 'cancel',\n            name: 'cancel',\n            text: 'Cancel'\n          },\n          {\n            type: 'submit',\n            name: 'save',\n            text: 'Save',\n            primary: true\n          }\n        ],\n        onSubmit: function (api) {\n          var serviceData = getSourceData(api);\n          submitForm(currentData.get(), serviceData, editor);\n          api.close();\n        },\n        onChange: function (api, detail) {\n          switch (detail.name) {\n          case 'source1':\n            handleSource1(currentData.get(), api);\n            break;\n          case 'embed':\n            handleEmbed(api);\n            break;\n          case 'dimensions':\n          case 'poster':\n            handleUpdate(api);\n            break;\n          default:\n            break;\n          }\n          currentData.set(getSourceData(api));\n        },\n        initialData: initialData\n      });\n    };\n    var Dialog = { showDialog: showDialog };\n\n    var get$1 = function (editor) {\n      var showDialog = function () {\n        Dialog.showDialog(editor);\n      };\n      return { showDialog: showDialog };\n    };\n    var Api = { get: get$1 };\n\n    var register = function (editor) {\n      var showDialog = function () {\n        Dialog.showDialog(editor);\n      };\n      editor.addCommand('mceMedia', showDialog);\n    };\n    var Commands = { register: register };\n\n    var global$7 = tinymce.util.Tools.resolve('tinymce.html.Node');\n\n    var global$8 = tinymce.util.Tools.resolve('tinymce.Env');\n\n    var sanitize = function (editor, html) {\n      if (Settings.shouldFilterHtml(editor) === false) {\n        return html;\n      }\n      var writer = global$5();\n      var blocked;\n      global$2({\n        validate: false,\n        allow_conditional_comments: false,\n        comment: function (text) {\n          writer.comment(text);\n        },\n        cdata: function (text) {\n          writer.cdata(text);\n        },\n        text: function (text, raw) {\n          writer.text(text, raw);\n        },\n        start: function (name, attrs, empty) {\n          blocked = true;\n          if (name === 'script' || name === 'noscript') {\n            return;\n          }\n          for (var i = 0; i < attrs.length; i++) {\n            if (attrs[i].name.indexOf('on') === 0) {\n              return;\n            }\n            if (attrs[i].name === 'style') {\n              attrs[i].value = editor.dom.serializeStyle(editor.dom.parseStyle(attrs[i].value), name);\n            }\n          }\n          writer.start(name, attrs, empty);\n          blocked = false;\n        },\n        end: function (name) {\n          if (blocked) {\n            return;\n          }\n          writer.end(name);\n        }\n      }, global$6({})).parse(html);\n      return writer.getContent();\n    };\n    var Sanitize = { sanitize: sanitize };\n\n    var createPlaceholderNode = function (editor, node) {\n      var placeHolder;\n      var name = node.name;\n      placeHolder = new global$7('img', 1);\n      placeHolder.shortEnded = true;\n      retainAttributesAndInnerHtml(editor, node, placeHolder);\n      placeHolder.attr({\n        'width': node.attr('width') || '300',\n        'height': node.attr('height') || (name === 'audio' ? '30' : '150'),\n        'style': node.attr('style'),\n        'src': global$8.transparentSrc,\n        'data-mce-object': name,\n        'class': 'mce-object mce-object-' + name\n      });\n      return placeHolder;\n    };\n    var createPreviewIframeNode = function (editor, node) {\n      var previewWrapper;\n      var previewNode;\n      var shimNode;\n      var name = node.name;\n      previewWrapper = new global$7('span', 1);\n      previewWrapper.attr({\n        'contentEditable': 'false',\n        'style': node.attr('style'),\n        'data-mce-object': name,\n        'class': 'mce-preview-object mce-object-' + name\n      });\n      retainAttributesAndInnerHtml(editor, node, previewWrapper);\n      previewNode = new global$7(name, 1);\n      previewNode.attr({\n        src: node.attr('src'),\n        allowfullscreen: node.attr('allowfullscreen'),\n        style: node.attr('style'),\n        class: node.attr('class'),\n        width: node.attr('width'),\n        height: node.attr('height'),\n        frameborder: '0'\n      });\n      shimNode = new global$7('span', 1);\n      shimNode.attr('class', 'mce-shim');\n      previewWrapper.append(previewNode);\n      previewWrapper.append(shimNode);\n      return previewWrapper;\n    };\n    var retainAttributesAndInnerHtml = function (editor, sourceNode, targetNode) {\n      var attrName;\n      var attrValue;\n      var attribs;\n      var ai;\n      var innerHtml;\n      attribs = sourceNode.attributes;\n      ai = attribs.length;\n      while (ai--) {\n        attrName = attribs[ai].name;\n        attrValue = attribs[ai].value;\n        if (attrName !== 'width' && attrName !== 'height' && attrName !== 'style') {\n          if (attrName === 'data' || attrName === 'src') {\n            attrValue = editor.convertURL(attrValue, attrName);\n          }\n          targetNode.attr('data-mce-p-' + attrName, attrValue);\n        }\n      }\n      innerHtml = sourceNode.firstChild && sourceNode.firstChild.value;\n      if (innerHtml) {\n        targetNode.attr('data-mce-html', escape(Sanitize.sanitize(editor, innerHtml)));\n        targetNode.firstChild = null;\n      }\n    };\n    var isPageEmbedWrapper = function (node) {\n      var nodeClass = node.attr('class');\n      return nodeClass && /\\btiny-pageembed\\b/.test(nodeClass);\n    };\n    var isWithinEmbedWrapper = function (node) {\n      while (node = node.parent) {\n        if (node.attr('data-ephox-embed-iri') || isPageEmbedWrapper(node)) {\n          return true;\n        }\n      }\n      return false;\n    };\n    var placeHolderConverter = function (editor) {\n      return function (nodes) {\n        var i = nodes.length;\n        var node;\n        var videoScript;\n        while (i--) {\n          node = nodes[i];\n          if (!node.parent) {\n            continue;\n          }\n          if (node.parent.attr('data-mce-object')) {\n            continue;\n          }\n          if (node.name === 'script') {\n            videoScript = getVideoScriptMatch(Settings.getScripts(editor), node.attr('src'));\n            if (!videoScript) {\n              continue;\n            }\n          }\n          if (videoScript) {\n            if (videoScript.width) {\n              node.attr('width', videoScript.width.toString());\n            }\n            if (videoScript.height) {\n              node.attr('height', videoScript.height.toString());\n            }\n          }\n          if (node.name === 'iframe' && Settings.hasLiveEmbeds(editor) && global$8.ceFalse) {\n            if (!isWithinEmbedWrapper(node)) {\n              node.replace(createPreviewIframeNode(editor, node));\n            }\n          } else {\n            if (!isWithinEmbedWrapper(node)) {\n              node.replace(createPlaceholderNode(editor, node));\n            }\n          }\n        }\n      };\n    };\n    var Nodes = {\n      createPreviewIframeNode: createPreviewIframeNode,\n      createPlaceholderNode: createPlaceholderNode,\n      placeHolderConverter: placeHolderConverter\n    };\n\n    var setup = function (editor) {\n      editor.on('preInit', function () {\n        var specialElements = editor.schema.getSpecialElements();\n        global$1.each('video audio iframe object'.split(' '), function (name) {\n          specialElements[name] = new RegExp('</' + name + '[^>]*>', 'gi');\n        });\n        var boolAttrs = editor.schema.getBoolAttrs();\n        global$1.each('webkitallowfullscreen mozallowfullscreen allowfullscreen'.split(' '), function (name) {\n          boolAttrs[name] = {};\n        });\n        editor.parser.addNodeFilter('iframe,video,audio,object,embed,script', Nodes.placeHolderConverter(editor));\n        editor.serializer.addAttributeFilter('data-mce-object', function (nodes, name) {\n          var i = nodes.length;\n          var node;\n          var realElm;\n          var ai;\n          var attribs;\n          var innerHtml;\n          var innerNode;\n          var realElmName;\n          var className;\n          while (i--) {\n            node = nodes[i];\n            if (!node.parent) {\n              continue;\n            }\n            realElmName = node.attr(name);\n            realElm = new global$7(realElmName, 1);\n            if (realElmName !== 'audio' && realElmName !== 'script') {\n              className = node.attr('class');\n              if (className && className.indexOf('mce-preview-object') !== -1) {\n                realElm.attr({\n                  width: node.firstChild.attr('width'),\n                  height: node.firstChild.attr('height')\n                });\n              } else {\n                realElm.attr({\n                  width: node.attr('width'),\n                  height: node.attr('height')\n                });\n              }\n            }\n            realElm.attr({ style: node.attr('style') });\n            attribs = node.attributes;\n            ai = attribs.length;\n            while (ai--) {\n              var attrName = attribs[ai].name;\n              if (attrName.indexOf('data-mce-p-') === 0) {\n                realElm.attr(attrName.substr(11), attribs[ai].value);\n              }\n            }\n            if (realElmName === 'script') {\n              realElm.attr('type', 'text/javascript');\n            }\n            innerHtml = node.attr('data-mce-html');\n            if (innerHtml) {\n              innerNode = new global$7('#text', 3);\n              innerNode.raw = true;\n              innerNode.value = Sanitize.sanitize(editor, unescape(innerHtml));\n              realElm.append(innerNode);\n            }\n            node.replace(realElm);\n          }\n        });\n      });\n      editor.on('SetContent', function () {\n        editor.$('span.mce-preview-object').each(function (index, elm) {\n          var $elm = editor.$(elm);\n          if ($elm.find('span.mce-shim').length === 0) {\n            $elm.append('<span class=\"mce-shim\"></span>');\n          }\n        });\n      });\n    };\n    var FilterContent = { setup: setup };\n\n    var setup$1 = function (editor) {\n      editor.on('ResolveName', function (e) {\n        var name;\n        if (e.target.nodeType === 1 && (name = e.target.getAttribute('data-mce-object'))) {\n          e.name = name;\n        }\n      });\n    };\n    var ResolveName = { setup: setup$1 };\n\n    var setup$2 = function (editor) {\n      editor.on('click keyup touchend', function () {\n        var selectedNode = editor.selection.getNode();\n        if (selectedNode && editor.dom.hasClass(selectedNode, 'mce-preview-object')) {\n          if (editor.dom.getAttrib(selectedNode, 'data-mce-selected')) {\n            selectedNode.setAttribute('data-mce-selected', '2');\n          }\n        }\n      });\n      editor.on('ObjectSelected', function (e) {\n        var objectType = e.target.getAttribute('data-mce-object');\n        if (objectType === 'audio' || objectType === 'script') {\n          e.preventDefault();\n        }\n      });\n      editor.on('ObjectResized', function (e) {\n        var target = e.target;\n        var html;\n        if (target.getAttribute('data-mce-object')) {\n          html = target.getAttribute('data-mce-html');\n          if (html) {\n            html = unescape(html);\n            target.setAttribute('data-mce-html', escape(UpdateHtml.updateHtml(html, {\n              width: String(e.width),\n              height: String(e.height)\n            })));\n          }\n        }\n      });\n    };\n    var Selection = { setup: setup$2 };\n\n    var stateSelectorAdapter = function (editor, selector) {\n      return function (buttonApi) {\n        return editor.selection.selectorChangedWithUnbind(selector.join(','), buttonApi.setActive).unbind;\n      };\n    };\n    var register$1 = function (editor) {\n      editor.ui.registry.addToggleButton('media', {\n        tooltip: 'Insert/edit media',\n        icon: 'embed',\n        onAction: function () {\n          editor.execCommand('mceMedia');\n        },\n        onSetup: stateSelectorAdapter(editor, [\n          'img[data-mce-object]',\n          'span[data-mce-object]',\n          'div[data-ephox-embed-iri]'\n        ])\n      });\n      editor.ui.registry.addMenuItem('media', {\n        icon: 'embed',\n        text: 'Media...',\n        onAction: function () {\n          editor.execCommand('mceMedia');\n        }\n      });\n    };\n    var Buttons = { register: register$1 };\n\n    function Plugin () {\n      global.add('media', function (editor) {\n        Commands.register(editor);\n        Buttons.register(editor);\n        ResolveName.setup(editor);\n        FilterContent.setup(editor);\n        Selection.setup(editor);\n        return Api.get(editor);\n      });\n    }\n\n    Plugin();\n\n}());\n"]}