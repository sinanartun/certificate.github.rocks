{"version":3,"sources":["autolink/plugin.js"],"names":["global","tinymce","util","Tools","resolve","global$1","Settings","editor","getParam","scopeIndex","container","index","nodeType","len","data","length","setStart","rng","offset","hasChildNodes","setStartBefore","setEnd","setEndAfter","parseCurrentLine","endOffset","delimiter","end","start","endContainer","bookmark","text","matches","prev","rngText","autoLinkPattern","defaultLinkTarget","selection","getNode","tagName","getRng","cloneRange","startOffset","previousSibling","firstChild","nextSibling","nodeValue","toString","charCodeAt","rangeString","rangeEqualsDelimiterOrSpace","charAt","trim","match","test","getBookmark","setRng","execCommand","dom","setAttrib","moveToBookmark","nodeChanged","Keys","setup","autoUrlDetectState","on","e","keyCode","handleEnter","browser","isIE","ex","handleEclipse","handleSpacebar","add"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.1.0 (2019-10-17)\n */\n(function () {\n    'use strict';\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.Env');\n\n    var getAutoLinkPattern = function (editor) {\n      return editor.getParam('autolink_pattern', /^(https?:\\/\\/|ssh:\\/\\/|ftp:\\/\\/|file:\\/|www\\.|(?:mailto:)?[A-Z0-9._%+\\-]+@)(.+)$/i);\n    };\n    var getDefaultLinkTarget = function (editor) {\n      return editor.getParam('default_link_target', false);\n    };\n    var Settings = {\n      getAutoLinkPattern: getAutoLinkPattern,\n      getDefaultLinkTarget: getDefaultLinkTarget\n    };\n\n    var rangeEqualsDelimiterOrSpace = function (rangeString, delimiter) {\n      return rangeString === delimiter || rangeString === ' ' || rangeString.charCodeAt(0) === 160;\n    };\n    var handleEclipse = function (editor) {\n      parseCurrentLine(editor, -1, '(');\n    };\n    var handleSpacebar = function (editor) {\n      parseCurrentLine(editor, 0, '');\n    };\n    var handleEnter = function (editor) {\n      parseCurrentLine(editor, -1, '');\n    };\n    var scopeIndex = function (container, index) {\n      if (index < 0) {\n        index = 0;\n      }\n      if (container.nodeType === 3) {\n        var len = container.data.length;\n        if (index > len) {\n          index = len;\n        }\n      }\n      return index;\n    };\n    var setStart = function (rng, container, offset) {\n      if (container.nodeType !== 1 || container.hasChildNodes()) {\n        rng.setStart(container, scopeIndex(container, offset));\n      } else {\n        rng.setStartBefore(container);\n      }\n    };\n    var setEnd = function (rng, container, offset) {\n      if (container.nodeType !== 1 || container.hasChildNodes()) {\n        rng.setEnd(container, scopeIndex(container, offset));\n      } else {\n        rng.setEndAfter(container);\n      }\n    };\n    var parseCurrentLine = function (editor, endOffset, delimiter) {\n      var rng, end, start, endContainer, bookmark, text, matches, prev, len, rngText;\n      var autoLinkPattern = Settings.getAutoLinkPattern(editor);\n      var defaultLinkTarget = Settings.getDefaultLinkTarget(editor);\n      if (editor.selection.getNode().tagName === 'A') {\n        return;\n      }\n      rng = editor.selection.getRng(true).cloneRange();\n      if (rng.startOffset < 5) {\n        prev = rng.endContainer.previousSibling;\n        if (!prev) {\n          if (!rng.endContainer.firstChild || !rng.endContainer.firstChild.nextSibling) {\n            return;\n          }\n          prev = rng.endContainer.firstChild.nextSibling;\n        }\n        len = prev.length;\n        setStart(rng, prev, len);\n        setEnd(rng, prev, len);\n        if (rng.endOffset < 5) {\n          return;\n        }\n        end = rng.endOffset;\n        endContainer = prev;\n      } else {\n        endContainer = rng.endContainer;\n        if (endContainer.nodeType !== 3 && endContainer.firstChild) {\n          while (endContainer.nodeType !== 3 && endContainer.firstChild) {\n            endContainer = endContainer.firstChild;\n          }\n          if (endContainer.nodeType === 3) {\n            setStart(rng, endContainer, 0);\n            setEnd(rng, endContainer, endContainer.nodeValue.length);\n          }\n        }\n        if (rng.endOffset === 1) {\n          end = 2;\n        } else {\n          end = rng.endOffset - 1 - endOffset;\n        }\n      }\n      start = end;\n      do {\n        setStart(rng, endContainer, end >= 2 ? end - 2 : 0);\n        setEnd(rng, endContainer, end >= 1 ? end - 1 : 0);\n        end -= 1;\n        rngText = rng.toString();\n      } while (rngText !== ' ' && rngText !== '' && rngText.charCodeAt(0) !== 160 && end - 2 >= 0 && rngText !== delimiter);\n      if (rangeEqualsDelimiterOrSpace(rng.toString(), delimiter)) {\n        setStart(rng, endContainer, end);\n        setEnd(rng, endContainer, start);\n        end += 1;\n      } else if (rng.startOffset === 0) {\n        setStart(rng, endContainer, 0);\n        setEnd(rng, endContainer, start);\n      } else {\n        setStart(rng, endContainer, end);\n        setEnd(rng, endContainer, start);\n      }\n      text = rng.toString();\n      if (text.charAt(text.length - 1) === '.') {\n        setEnd(rng, endContainer, start - 1);\n      }\n      text = rng.toString().trim();\n      matches = text.match(autoLinkPattern);\n      if (matches) {\n        if (matches[1] === 'www.') {\n          matches[1] = 'http://www.';\n        } else if (/@$/.test(matches[1]) && !/^mailto:/.test(matches[1])) {\n          matches[1] = 'mailto:' + matches[1];\n        }\n        bookmark = editor.selection.getBookmark();\n        editor.selection.setRng(rng);\n        editor.execCommand('createlink', false, matches[1] + matches[2]);\n        if (defaultLinkTarget !== false) {\n          editor.dom.setAttrib(editor.selection.getNode(), 'target', defaultLinkTarget);\n        }\n        editor.selection.moveToBookmark(bookmark);\n        editor.nodeChanged();\n      }\n    };\n    var setup = function (editor) {\n      var autoUrlDetectState;\n      editor.on('keydown', function (e) {\n        if (e.keyCode === 13) {\n          return handleEnter(editor);\n        }\n      });\n      if (global$1.browser.isIE()) {\n        editor.on('focus', function () {\n          if (!autoUrlDetectState) {\n            autoUrlDetectState = true;\n            try {\n              editor.execCommand('AutoUrlDetect', false, true);\n            } catch (ex) {\n            }\n          }\n        });\n        return;\n      }\n      editor.on('keypress', function (e) {\n        if (e.keyCode === 41) {\n          return handleEclipse(editor);\n        }\n      });\n      editor.on('keyup', function (e) {\n        if (e.keyCode === 32) {\n          return handleSpacebar(editor);\n        }\n      });\n    };\n    var Keys = { setup: setup };\n\n    function Plugin () {\n      global.add('autolink', function (editor) {\n        Keys.setup(editor);\n      });\n    }\n\n    Plugin();\n\n}());\n"]}