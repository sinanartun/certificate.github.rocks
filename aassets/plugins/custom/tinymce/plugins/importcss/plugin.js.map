{"version":3,"sources":["importcss/plugin.js"],"names":["eq","call","id","me","global","tinymce","util","Tools","resolve","global$1","global$2","global$3","global$4","Settings","editor","getParam","noop","constant","value","never","always","none","NONE","o","isNone","fold","n","s","is","isSome","getOr","getOrThunk","thunk","getOrDie","msg","Error","getOrNull","getOrUndefined","undefined","or","orThunk","map","each","bind","exists","forall","filter","equals","equals_","toArray","toString","Object","freeze","isType","type","x","t","Array","prototype","isPrototypeOf","constructor","name","String","typeOf","isArray","isFunction","nativeSlice","slice","nativePush","push","xs","f","r","i","len","length","apply","flatten","removeCacheSuffix","from","url","cacheSuffix","replace","isSkinContentCss","href","settings","skin","skinUrl","skin_url","documentBaseURI","toAbsolute","baseURL","contentSkinUrlPart","inline","indexOf","compileFilter","RegExp","test","getSelectors","doc","fileFilter","selectors","contentCSSUrls","contentCSS","imported","styleSheets","styleSheet","append","rules","imports","cssRules","e","cssRule","selectorText","split","selector","trim","defaultConvertSelectorToFormat","format","exec","elementName","classes","substr","join","inlineSelectorElements","makeMap","title","schema","getTextBlockElements","block","getBlockElements","toLowerCase","attributes","class","isExclusiveMode","group","ImportCss","setup","on","model","ungroupedOrder","groupOrder","groups","addItemToGroup","groupTitle","itemInfo","addItem","toFormats","g","items","concat","generate","globallyUniqueSelectors","selectorFilter","extend","original","item","text","menu","compileUserDefinedGroups","processSelector","isUniqueSelector","markUniqueSelector","plugin","selector_converter","convertSelectorToFormat","plugins","importcss","formatName","DOM","uniqueId","formatter","register","getDoc","selectorGroups","grep","getGroupsBySelector","menuItem","fire","Api","get","add"],"mappings":"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","file":"plugin.js","sourcesContent":["/**\n * Copyright (c) Tiny Technologies, Inc. All rights reserved.\n * Licensed under the LGPL or a commercial license.\n * For LGPL see License.txt in the project root for license information.\n * For commercial licenses see https://www.tiny.cloud/\n *\n * Version: 5.1.0 (2019-10-17)\n */\n(function () {\n    'use strict';\n\n    var global = tinymce.util.Tools.resolve('tinymce.PluginManager');\n\n    var global$1 = tinymce.util.Tools.resolve('tinymce.dom.DOMUtils');\n\n    var global$2 = tinymce.util.Tools.resolve('tinymce.EditorManager');\n\n    var global$3 = tinymce.util.Tools.resolve('tinymce.Env');\n\n    var global$4 = tinymce.util.Tools.resolve('tinymce.util.Tools');\n\n    var shouldMergeClasses = function (editor) {\n      return editor.getParam('importcss_merge_classes');\n    };\n    var shouldImportExclusive = function (editor) {\n      return editor.getParam('importcss_exclusive');\n    };\n    var getSelectorConverter = function (editor) {\n      return editor.getParam('importcss_selector_converter');\n    };\n    var getSelectorFilter = function (editor) {\n      return editor.getParam('importcss_selector_filter');\n    };\n    var getCssGroups = function (editor) {\n      return editor.getParam('importcss_groups');\n    };\n    var shouldAppend = function (editor) {\n      return editor.getParam('importcss_append');\n    };\n    var getFileFilter = function (editor) {\n      return editor.getParam('importcss_file_filter');\n    };\n    var Settings = {\n      shouldMergeClasses: shouldMergeClasses,\n      shouldImportExclusive: shouldImportExclusive,\n      getSelectorConverter: getSelectorConverter,\n      getSelectorFilter: getSelectorFilter,\n      getCssGroups: getCssGroups,\n      shouldAppend: shouldAppend,\n      getFileFilter: getFileFilter\n    };\n\n    var noop = function () {\n    };\n    var constant = function (value) {\n      return function () {\n        return value;\n      };\n    };\n    var never = constant(false);\n    var always = constant(true);\n\n    var none = function () {\n      return NONE;\n    };\n    var NONE = function () {\n      var eq = function (o) {\n        return o.isNone();\n      };\n      var call = function (thunk) {\n        return thunk();\n      };\n      var id = function (n) {\n        return n;\n      };\n      var me = {\n        fold: function (n, s) {\n          return n();\n        },\n        is: never,\n        isSome: never,\n        isNone: always,\n        getOr: id,\n        getOrThunk: call,\n        getOrDie: function (msg) {\n          throw new Error(msg || 'error: getOrDie called on none.');\n        },\n        getOrNull: constant(null),\n        getOrUndefined: constant(undefined),\n        or: id,\n        orThunk: call,\n        map: none,\n        each: noop,\n        bind: none,\n        exists: never,\n        forall: always,\n        filter: none,\n        equals: eq,\n        equals_: eq,\n        toArray: function () {\n          return [];\n        },\n        toString: constant('none()')\n      };\n      if (Object.freeze) {\n        Object.freeze(me);\n      }\n      return me;\n    }();\n\n    var typeOf = function (x) {\n      if (x === null) {\n        return 'null';\n      }\n      var t = typeof x;\n      if (t === 'object' && (Array.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'Array')) {\n        return 'array';\n      }\n      if (t === 'object' && (String.prototype.isPrototypeOf(x) || x.constructor && x.constructor.name === 'String')) {\n        return 'string';\n      }\n      return t;\n    };\n    var isType = function (type) {\n      return function (value) {\n        return typeOf(value) === type;\n      };\n    };\n    var isArray = isType('array');\n    var isFunction = isType('function');\n\n    var nativeSlice = Array.prototype.slice;\n    var nativePush = Array.prototype.push;\n    var map = function (xs, f) {\n      var len = xs.length;\n      var r = new Array(len);\n      for (var i = 0; i < len; i++) {\n        var x = xs[i];\n        r[i] = f(x, i);\n      }\n      return r;\n    };\n    var flatten = function (xs) {\n      var r = [];\n      for (var i = 0, len = xs.length; i < len; ++i) {\n        if (!isArray(xs[i])) {\n          throw new Error('Arr.flatten item ' + i + ' was not an array, input: ' + xs);\n        }\n        nativePush.apply(r, xs[i]);\n      }\n      return r;\n    };\n    var bind = function (xs, f) {\n      var output = map(xs, f);\n      return flatten(output);\n    };\n    var from = isFunction(Array.from) ? Array.from : function (x) {\n      return nativeSlice.call(x);\n    };\n\n    var generate = function () {\n      var ungroupedOrder = [];\n      var groupOrder = [];\n      var groups = {};\n      var addItemToGroup = function (groupTitle, itemInfo) {\n        if (groups[groupTitle]) {\n          groups[groupTitle].push(itemInfo);\n        } else {\n          groupOrder.push(groupTitle);\n          groups[groupTitle] = [itemInfo];\n        }\n      };\n      var addItem = function (itemInfo) {\n        ungroupedOrder.push(itemInfo);\n      };\n      var toFormats = function () {\n        var groupItems = bind(groupOrder, function (g) {\n          var items = groups[g];\n          return items.length === 0 ? [] : [{\n              title: g,\n              items: items\n            }];\n        });\n        return groupItems.concat(ungroupedOrder);\n      };\n      return {\n        addItemToGroup: addItemToGroup,\n        addItem: addItem,\n        toFormats: toFormats\n      };\n    };\n\n    var removeCacheSuffix = function (url) {\n      var cacheSuffix = global$3.cacheSuffix;\n      if (typeof url === 'string') {\n        url = url.replace('?' + cacheSuffix, '').replace('&' + cacheSuffix, '');\n      }\n      return url;\n    };\n    var isSkinContentCss = function (editor, href) {\n      var settings = editor.settings, skin = settings.skin !== false ? settings.skin || 'oxide' : false;\n      if (skin) {\n        var skinUrl = settings.skin_url ? editor.documentBaseURI.toAbsolute(settings.skin_url) : global$2.baseURL + '/skins/ui/' + skin;\n        var contentSkinUrlPart = global$2.baseURL + '/skins/content/';\n        return href === skinUrl + '/content' + (editor.inline ? '.inline' : '') + '.min.css' || href.indexOf(contentSkinUrlPart) !== -1;\n      }\n      return false;\n    };\n    var compileFilter = function (filter) {\n      if (typeof filter === 'string') {\n        return function (value) {\n          return value.indexOf(filter) !== -1;\n        };\n      } else if (filter instanceof RegExp) {\n        return function (value) {\n          return filter.test(value);\n        };\n      }\n      return filter;\n    };\n    var getSelectors = function (editor, doc, fileFilter) {\n      var selectors = [], contentCSSUrls = {};\n      function append(styleSheet, imported) {\n        var href = styleSheet.href, rules;\n        href = removeCacheSuffix(href);\n        if (!href || !fileFilter(href, imported) || isSkinContentCss(editor, href)) {\n          return;\n        }\n        global$4.each(styleSheet.imports, function (styleSheet) {\n          append(styleSheet, true);\n        });\n        try {\n          rules = styleSheet.cssRules || styleSheet.rules;\n        } catch (e) {\n        }\n        global$4.each(rules, function (cssRule) {\n          if (cssRule.styleSheet) {\n            append(cssRule.styleSheet, true);\n          } else if (cssRule.selectorText) {\n            global$4.each(cssRule.selectorText.split(','), function (selector) {\n              selectors.push(global$4.trim(selector));\n            });\n          }\n        });\n      }\n      global$4.each(editor.contentCSS, function (url) {\n        contentCSSUrls[url] = true;\n      });\n      if (!fileFilter) {\n        fileFilter = function (href, imported) {\n          return imported || contentCSSUrls[href];\n        };\n      }\n      try {\n        global$4.each(doc.styleSheets, function (styleSheet) {\n          append(styleSheet);\n        });\n      } catch (e) {\n      }\n      return selectors;\n    };\n    var defaultConvertSelectorToFormat = function (editor, selectorText) {\n      var format;\n      var selector = /^(?:([a-z0-9\\-_]+))?(\\.[a-z0-9_\\-\\.]+)$/i.exec(selectorText);\n      if (!selector) {\n        return;\n      }\n      var elementName = selector[1];\n      var classes = selector[2].substr(1).split('.').join(' ');\n      var inlineSelectorElements = global$4.makeMap('a,img');\n      if (selector[1]) {\n        format = { title: selectorText };\n        if (editor.schema.getTextBlockElements()[elementName]) {\n          format.block = elementName;\n        } else if (editor.schema.getBlockElements()[elementName] || inlineSelectorElements[elementName.toLowerCase()]) {\n          format.selector = elementName;\n        } else {\n          format.inline = elementName;\n        }\n      } else if (selector[2]) {\n        format = {\n          inline: 'span',\n          title: selectorText.substr(1),\n          classes: classes\n        };\n      }\n      if (Settings.shouldMergeClasses(editor) !== false) {\n        format.classes = classes;\n      } else {\n        format.attributes = { class: classes };\n      }\n      return format;\n    };\n    var getGroupsBySelector = function (groups, selector) {\n      return global$4.grep(groups, function (group) {\n        return !group.filter || group.filter(selector);\n      });\n    };\n    var compileUserDefinedGroups = function (groups) {\n      return global$4.map(groups, function (group) {\n        return global$4.extend({}, group, {\n          original: group,\n          selectors: {},\n          filter: compileFilter(group.filter),\n          item: {\n            text: group.title,\n            menu: []\n          }\n        });\n      });\n    };\n    var isExclusiveMode = function (editor, group) {\n      return group === null || Settings.shouldImportExclusive(editor) !== false;\n    };\n    var isUniqueSelector = function (editor, selector, group, globallyUniqueSelectors) {\n      return !(isExclusiveMode(editor, group) ? selector in globallyUniqueSelectors : selector in group.selectors);\n    };\n    var markUniqueSelector = function (editor, selector, group, globallyUniqueSelectors) {\n      if (isExclusiveMode(editor, group)) {\n        globallyUniqueSelectors[selector] = true;\n      } else {\n        group.selectors[selector] = true;\n      }\n    };\n    var convertSelectorToFormat = function (editor, plugin, selector, group) {\n      var selectorConverter;\n      if (group && group.selector_converter) {\n        selectorConverter = group.selector_converter;\n      } else if (Settings.getSelectorConverter(editor)) {\n        selectorConverter = Settings.getSelectorConverter(editor);\n      } else {\n        selectorConverter = function () {\n          return defaultConvertSelectorToFormat(editor, selector);\n        };\n      }\n      return selectorConverter.call(plugin, selector, group);\n    };\n    var setup = function (editor) {\n      editor.on('init', function (e) {\n        var model = generate();\n        var globallyUniqueSelectors = {};\n        var selectorFilter = compileFilter(Settings.getSelectorFilter(editor));\n        var groups = compileUserDefinedGroups(Settings.getCssGroups(editor));\n        var processSelector = function (selector, group) {\n          if (isUniqueSelector(editor, selector, group, globallyUniqueSelectors)) {\n            markUniqueSelector(editor, selector, group, globallyUniqueSelectors);\n            var format = convertSelectorToFormat(editor, editor.plugins.importcss, selector, group);\n            if (format) {\n              var formatName = format.name || global$1.DOM.uniqueId();\n              editor.formatter.register(formatName, format);\n              return global$4.extend({}, {\n                title: format.title,\n                format: formatName\n              });\n            }\n          }\n          return null;\n        };\n        global$4.each(getSelectors(editor, editor.getDoc(), compileFilter(Settings.getFileFilter(editor))), function (selector) {\n          if (selector.indexOf('.mce-') === -1) {\n            if (!selectorFilter || selectorFilter(selector)) {\n              var selectorGroups = getGroupsBySelector(groups, selector);\n              if (selectorGroups.length > 0) {\n                global$4.each(selectorGroups, function (group) {\n                  var menuItem = processSelector(selector, group);\n                  if (menuItem) {\n                    model.addItemToGroup(group.title, menuItem);\n                  }\n                });\n              } else {\n                var menuItem = processSelector(selector, null);\n                if (menuItem) {\n                  model.addItem(menuItem);\n                }\n              }\n            }\n          }\n        });\n        var items = model.toFormats();\n        editor.fire('addStyleModifications', {\n          items: items,\n          replace: !Settings.shouldAppend(editor)\n        });\n      });\n    };\n    var ImportCss = {\n      defaultConvertSelectorToFormat: defaultConvertSelectorToFormat,\n      setup: setup\n    };\n\n    var get = function (editor) {\n      var convertSelectorToFormat = function (selectorText) {\n        return ImportCss.defaultConvertSelectorToFormat(editor, selectorText);\n      };\n      return { convertSelectorToFormat: convertSelectorToFormat };\n    };\n    var Api = { get: get };\n\n    function Plugin () {\n      global.add('importcss', function (editor) {\n        ImportCss.setup(editor);\n        return Api.get(editor);\n      });\n    }\n\n    Plugin();\n\n}());\n"]}